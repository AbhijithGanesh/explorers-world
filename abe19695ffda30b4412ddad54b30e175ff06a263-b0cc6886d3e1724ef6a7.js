(self.webpackChunkexplorer_world=self.webpackChunkexplorer_world||[]).push([[287],{6218:function(e,t,n){n(5743);var r=function(){if("object"==typeof self&&self)return self;if("object"==typeof window&&window)return window;throw new Error("Unable to resolve global `this`")};e.exports=function(){if(this)return this;if("object"==typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(e){return r()}try{return __global__||r()}finally{delete Object.prototype.__global__}}()},2960:function(e,t,n){var r;if(n(5743),"object"==typeof globalThis)r=globalThis;else try{r=n(6218)}catch(a){}finally{if(r||"undefined"==typeof window||(r=window),!r)throw new Error("Could not determine global this")}var i=r.WebSocket||r.MozWebSocket,s=n(7284);function o(e,t){return t?new i(e,t):new i(e)}i&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach((function(e){Object.defineProperty(o,e,{get:function(){return i[e]}})})),e.exports={w3cwebsocket:i?o:null,version:s}},7284:function(e,t,n){e.exports=n(9794).version},5837:function(e,t,n){n(2109)({global:!0},{globalThis:n(7854)})},5743:function(e,t,n){n(5837)},485:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}n.d(t,{O:function(){return ht}});var o=n(4687),a=n.n(o),c={"X-Client-Info":"supabase-js/".concat("1.35.4")};var u=n(9611);function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&(0,u.Z)(e,t)}function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function f(e,t){if(t&&("object"===l(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}var v={"X-Client-Info":"gotrue-js/".concat("1.22.20")},p="Request Failed",k=10,m=2,y="supabase.auth.token",b={name:"sb",lifetime:28800,domain:"",path:"/",sameSite:"lax"},g=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(t){s(t)}}function a(e){try{c(r.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))},w=function(e){return e.msg||e.message||e.error_description||e.error||JSON.stringify(e)},x=function(e,t){return(null==e?void 0:e.status)?"function"!=typeof e.json?t(e):void e.json().then((function(n){return t({message:w(n),status:(null==e?void 0:e.status)||500})})):t({message:p})},_=function(e,t,n){var r={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e||(r.headers=Object.assign({"Content-Type":"text/plain;charset=UTF-8"},null==t?void 0:t.headers),r.body=JSON.stringify(n)),r};function T(e,t,n,r,i){return g(this,void 0,void 0,a().mark((function s(){return a().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",new Promise((function(s,o){e(n,_(t,r,i)).then((function(e){if(!e.ok)throw e;return(null==r?void 0:r.noResolveJson)?s:e.json()})).then((function(e){return s(e)})).catch((function(e){return x(e,o)}))})));case 1:case"end":return s.stop()}}),s)})))}function S(e,t,n){return g(this,void 0,void 0,a().mark((function r(){return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",T(e,"GET",t,n));case 1:case"end":return r.stop()}}),r)})))}function O(e,t,n,r){return g(this,void 0,void 0,a().mark((function i(){return a().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",T(e,"POST",t,r,n));case 1:case"end":return i.stop()}}),i)})))}function E(e,t,n,r){return g(this,void 0,void 0,a().mark((function i(){return a().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",T(e,"PUT",t,r,n));case 1:case"end":return i.stop()}}),i)})))}function j(e,t,n,r){return g(this,void 0,void 0,a().mark((function i(){return a().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",T(e,"DELETE",t,r,n));case 1:case"end":return i.stop()}}),i)})))}function P(e,t){var n,r,i;return function(e,t,n){var r=n||{},i=encodeURIComponent,s=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;if("function"!=typeof i)throw new TypeError("option encode is invalid");if(!s.test(e))throw new TypeError("argument name is invalid");var o=i(t);if(o&&!s.test(o))throw new TypeError("argument val is invalid");var a=e+"="+o;if(null!=r.maxAge){var c=r.maxAge-0;if(isNaN(c)||!isFinite(c))throw new TypeError("option maxAge is invalid");a+="; Max-Age="+Math.floor(c)}if(r.domain){if(!s.test(r.domain))throw new TypeError("option domain is invalid");a+="; Domain="+r.domain}if(r.path){if(!s.test(r.path))throw new TypeError("option path is invalid");a+="; Path="+r.path}if(r.expires){if("function"!=typeof r.expires.toUTCString)throw new TypeError("option expires is invalid");a+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(a+="; HttpOnly"),r.secure&&(a+="; Secure"),r.sameSite)switch("string"==typeof r.sameSite?r.sameSite.toLowerCase():r.sameSite){case"lax":a+="; SameSite=Lax";break;case"strict":a+="; SameSite=Strict";break;case"none":a+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return a}(e.name,e.value,{maxAge:e.maxAge,expires:new Date(Date.now()+1e3*e.maxAge),httpOnly:!0,secure:t,path:null!==(n=e.path)&&void 0!==n?n:"/",domain:null!==(r=e.domain)&&void 0!==r?r:"",sameSite:null!==(i=e.sameSite)&&void 0!==i?i:"lax"})}function R(e,t,n){var r=n.map((function(t){return P(t,function(e){if(!e||!e.headers||!e.headers.host)throw new Error('The "host" request header is not available');var t=e.headers.host.indexOf(":")>-1&&e.headers.host.split(":")[0]||e.headers.host;return!(["localhost","127.0.0.1"].indexOf(t)>-1||t.endsWith(".local"))}(e))})),i=t.getHeader("Set-Cookie");return i&&(i instanceof Array?Array.prototype.push.apply(r,i):"string"==typeof i&&r.push(i)),r}function C(e,t,n){t.setHeader("Set-Cookie",R(e,t,n))}var I=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(t){s(t)}}function a(e){try{c(r.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};function A(e){return Math.round(Date.now()/1e3)+e}var U=function(){return"undefined"!=typeof window};function N(e,t){var n;t||(t=(null===(n=null===window||void 0===window?void 0:window.location)||void 0===n?void 0:n.href)||""),e=e.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&#]"+e+"(=([^&#]*)|&|#|$)").exec(t);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null}var D=function(e){var t;return t=e||("undefined"==typeof fetch?function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return I(void 0,void 0,void 0,a().mark((function e(){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.e(944).then(n.t.bind(n,4944,23));case 2:return e.next=4,(r=e.sent).fetch.apply(r,t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})))}:fetch),function(){return t.apply(void 0,arguments)}},B=function(e,t){return I(void 0,void 0,void 0,a().mark((function n(){var r;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.t0=U(),!n.t0){n.next=5;break}return n.next=4,null==e?void 0:e.getItem(t);case 4:n.t0=n.sent;case 5:if(r=n.t0){n.next=8;break}return n.abrupt("return",null);case 8:return n.prev=8,n.abrupt("return",JSON.parse(r));case 12:return n.prev=12,n.t1=n.catch(8),n.abrupt("return",r);case 15:case"end":return n.stop()}}),n,null,[[8,12]])})))},L=function(e,t){return I(void 0,void 0,void 0,a().mark((function n(){return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.t0=U(),!n.t0){n.next=4;break}return n.next=4,null==e?void 0:e.removeItem(t);case 4:case"end":return n.stop()}}),n)})))},J=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(t){s(t)}}function a(e){try{c(r.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))},M=function(){function e(t){var n=t.url,i=void 0===n?"":n,s=t.headers,o=void 0===s?{}:s,a=t.cookieOptions,c=t.fetch;r(this,e),this.url=i,this.headers=o,this.cookieOptions=Object.assign(Object.assign({},b),a),this.fetch=D(c)}return s(e,[{key:"_createRequestHeaders",value:function(e){var t=Object.assign({},this.headers);return t.Authorization="Bearer ".concat(e),t}},{key:"cookieName",value:function(){var e;return null!==(e=this.cookieOptions.name)&&void 0!==e?e:""}},{key:"getUrlForProvider",value:function(e,t){var n=["provider=".concat(encodeURIComponent(e))];if((null==t?void 0:t.redirectTo)&&n.push("redirect_to=".concat(encodeURIComponent(t.redirectTo))),(null==t?void 0:t.scopes)&&n.push("scopes=".concat(encodeURIComponent(t.scopes))),null==t?void 0:t.queryParams){var r=new URLSearchParams(t.queryParams);n.push("".concat(r))}return"".concat(this.url,"/authorize?").concat(n.join("&"))}},{key:"signUpWithEmail",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return J(this,void 0,void 0,a().mark((function r(){var i,s,o,c;return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,i=Object.assign({},this.headers),s="",n.redirectTo&&(s="?redirect_to="+encodeURIComponent(n.redirectTo)),r.next=6,O(this.fetch,"".concat(this.url,"/signup").concat(s),{email:e,password:t,data:n.data,gotrue_meta_security:{captcha_token:n.captchaToken}},{headers:i});case 6:return o=r.sent,(c=Object.assign({},o)).expires_in&&(c.expires_at=A(o.expires_in)),r.abrupt("return",{data:c,error:null});case 12:return r.prev=12,r.t0=r.catch(0),r.abrupt("return",{data:null,error:r.t0});case 15:case"end":return r.stop()}}),r,this,[[0,12]])})))}},{key:"signInWithEmail",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return J(this,void 0,void 0,a().mark((function r(){var i,s,o,c;return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,i=Object.assign({},this.headers),s="?grant_type=password",n.redirectTo&&(s+="&redirect_to="+encodeURIComponent(n.redirectTo)),r.next=6,O(this.fetch,"".concat(this.url,"/token").concat(s),{email:e,password:t},{headers:i});case 6:return o=r.sent,(c=Object.assign({},o)).expires_in&&(c.expires_at=A(o.expires_in)),r.abrupt("return",{data:c,error:null});case 12:return r.prev=12,r.t0=r.catch(0),r.abrupt("return",{data:null,error:r.t0});case 15:case"end":return r.stop()}}),r,this,[[0,12]])})))}},{key:"signUpWithPhone",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return J(this,void 0,void 0,a().mark((function r(){var i,s,o;return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,i=Object.assign({},this.headers),r.next=4,O(this.fetch,"".concat(this.url,"/signup"),{phone:e,password:t,data:n.data,gotrue_meta_security:{captcha_token:n.captchaToken}},{headers:i});case 4:return s=r.sent,(o=Object.assign({},s)).expires_in&&(o.expires_at=A(s.expires_in)),r.abrupt("return",{data:o,error:null});case 10:return r.prev=10,r.t0=r.catch(0),r.abrupt("return",{data:null,error:r.t0});case 13:case"end":return r.stop()}}),r,this,[[0,10]])})))}},{key:"signInWithPhone",value:function(e,t){return J(this,void 0,void 0,a().mark((function n(){var r,i,s;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,r=Object.assign({},this.headers),"?grant_type=password",n.next=5,O(this.fetch,"".concat(this.url,"/token").concat("?grant_type=password"),{phone:e,password:t},{headers:r});case 5:return i=n.sent,(s=Object.assign({},i)).expires_in&&(s.expires_at=A(i.expires_in)),n.abrupt("return",{data:s,error:null});case 11:return n.prev=11,n.t0=n.catch(0),n.abrupt("return",{data:null,error:n.t0});case 14:case"end":return n.stop()}}),n,this,[[0,11]])})))}},{key:"signInWithOpenIDConnect",value:function(e){var t=e.id_token,n=e.nonce,r=e.client_id,i=e.issuer,s=e.provider;return J(this,void 0,void 0,a().mark((function e(){var o,c,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o=Object.assign({},this.headers),"?grant_type=id_token",e.next=5,O(this.fetch,"".concat(this.url,"/token").concat("?grant_type=id_token"),{id_token:t,nonce:n,client_id:r,issuer:i,provider:s},{headers:o});case 5:return c=e.sent,(u=Object.assign({},c)).expires_in&&(u.expires_at=A(c.expires_in)),e.abrupt("return",{data:u,error:null});case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",{data:null,error:e.t0});case 14:case"end":return e.stop()}}),e,this,[[0,11]])})))}},{key:"sendMagicLinkEmail",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return J(this,void 0,void 0,a().mark((function r(){var i,s,o,c;return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,i=Object.assign({},this.headers),s="",n.redirectTo&&(s+="?redirect_to="+encodeURIComponent(n.redirectTo)),o=null===(t=n.shouldCreateUser)||void 0===t||t,r.next=7,O(this.fetch,"".concat(this.url,"/otp").concat(s),{email:e,create_user:o,gotrue_meta_security:{captcha_token:n.captchaToken}},{headers:i});case 7:return c=r.sent,r.abrupt("return",{data:c,error:null});case 11:return r.prev=11,r.t0=r.catch(0),r.abrupt("return",{data:null,error:r.t0});case 14:case"end":return r.stop()}}),r,this,[[0,11]])})))}},{key:"sendMobileOTP",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return J(this,void 0,void 0,a().mark((function r(){var i,s,o;return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,i=null===(t=n.shouldCreateUser)||void 0===t||t,s=Object.assign({},this.headers),r.next=5,O(this.fetch,"".concat(this.url,"/otp"),{phone:e,create_user:i,gotrue_meta_security:{captcha_token:n.captchaToken}},{headers:s});case 5:return o=r.sent,r.abrupt("return",{data:o,error:null});case 9:return r.prev=9,r.t0=r.catch(0),r.abrupt("return",{data:null,error:r.t0});case 12:case"end":return r.stop()}}),r,this,[[0,9]])})))}},{key:"signOut",value:function(e){return J(this,void 0,void 0,a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,O(this.fetch,"".concat(this.url,"/logout"),{},{headers:this._createRequestHeaders(e),noResolveJson:!0});case 3:return t.abrupt("return",{error:null});case 6:return t.prev=6,t.t0=t.catch(0),t.abrupt("return",{error:t.t0});case 9:case"end":return t.stop()}}),t,this,[[0,6]])})))}},{key:"verifyMobileOTP",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return J(this,void 0,void 0,a().mark((function r(){var i,s,o;return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,i=Object.assign({},this.headers),r.next=4,O(this.fetch,"".concat(this.url,"/verify"),{phone:e,token:t,type:"sms",redirect_to:n.redirectTo},{headers:i});case 4:return s=r.sent,(o=Object.assign({},s)).expires_in&&(o.expires_at=A(s.expires_in)),r.abrupt("return",{data:o,error:null});case 10:return r.prev=10,r.t0=r.catch(0),r.abrupt("return",{data:null,error:r.t0});case 13:case"end":return r.stop()}}),r,this,[[0,10]])})))}},{key:"verifyOTP",value:function(e){var t=e.email,n=e.phone,r=e.token,i=e.type,s=void 0===i?"sms":i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return J(this,void 0,void 0,a().mark((function e(){var i,c,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i=Object.assign({},this.headers),e.next=4,O(this.fetch,"".concat(this.url,"/verify"),{email:t,phone:n,token:r,type:s,redirect_to:o.redirectTo},{headers:i});case 4:return c=e.sent,(u=Object.assign({},c)).expires_in&&(u.expires_at=A(c.expires_in)),e.abrupt("return",{data:u,error:null});case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",{data:null,error:e.t0});case 13:case"end":return e.stop()}}),e,this,[[0,10]])})))}},{key:"inviteUserByEmail",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return J(this,void 0,void 0,a().mark((function n(){var r,i,s;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,r=Object.assign({},this.headers),i="",t.redirectTo&&(i+="?redirect_to="+encodeURIComponent(t.redirectTo)),n.next=6,O(this.fetch,"".concat(this.url,"/invite").concat(i),{email:e,data:t.data},{headers:r});case 6:return s=n.sent,n.abrupt("return",{data:s,error:null});case 10:return n.prev=10,n.t0=n.catch(0),n.abrupt("return",{data:null,error:n.t0});case 13:case"end":return n.stop()}}),n,this,[[0,10]])})))}},{key:"resetPasswordForEmail",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return J(this,void 0,void 0,a().mark((function n(){var r,i,s;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,r=Object.assign({},this.headers),i="",t.redirectTo&&(i+="?redirect_to="+encodeURIComponent(t.redirectTo)),n.next=6,O(this.fetch,"".concat(this.url,"/recover").concat(i),{email:e,gotrue_meta_security:{captcha_token:t.captchaToken}},{headers:r});case 6:return s=n.sent,n.abrupt("return",{data:s,error:null});case 10:return n.prev=10,n.t0=n.catch(0),n.abrupt("return",{data:null,error:n.t0});case 13:case"end":return n.stop()}}),n,this,[[0,10]])})))}},{key:"refreshAccessToken",value:function(e){return J(this,void 0,void 0,a().mark((function t(){var n,r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,O(this.fetch,"".concat(this.url,"/token?grant_type=refresh_token"),{refresh_token:e},{headers:this.headers});case 3:return n=t.sent,(r=Object.assign({},n)).expires_in&&(r.expires_at=A(n.expires_in)),t.abrupt("return",{data:r,error:null});case 9:return t.prev=9,t.t0=t.catch(0),t.abrupt("return",{data:null,error:t.t0});case 12:case"end":return t.stop()}}),t,this,[[0,9]])})))}},{key:"setAuthCookie",value:function(e,t){var n=this;"POST"!==e.method&&(t.setHeader("Allow","POST"),t.status(405).end("Method Not Allowed"));var r=e.body,i=r.event,s=r.session;if(!i)throw new Error("Auth event missing!");if("SIGNED_IN"===i){if(!s)throw new Error("Auth session missing!");C(e,t,[{key:"access-token",value:s.access_token},{key:"refresh-token",value:s.refresh_token}].map((function(e){var t;return{name:"".concat(n.cookieName(),"-").concat(e.key),value:e.value,domain:n.cookieOptions.domain,maxAge:null!==(t=n.cookieOptions.lifetime)&&void 0!==t?t:0,path:n.cookieOptions.path,sameSite:n.cookieOptions.sameSite}})))}"SIGNED_OUT"===i&&C(e,t,["access-token","refresh-token"].map((function(e){return{name:"".concat(n.cookieName(),"-").concat(e),value:"",maxAge:-1}}))),t.status(200).json({})}},{key:"deleteAuthCookie",value:function(e,t,n){var r=this,i=n.redirectTo,s=void 0===i?"/":i;return C(e,t,["access-token","refresh-token"].map((function(e){return{name:"".concat(r.cookieName(),"-").concat(e),value:"",maxAge:-1}}))),t.redirect(307,s)}},{key:"getAuthCookieString",value:function(e,t){var n=this;"POST"!==e.method&&(t.setHeader("Allow","POST"),t.status(405).end("Method Not Allowed"));var r=e.body,i=r.event,s=r.session;if(!i)throw new Error("Auth event missing!");if("SIGNED_IN"===i){if(!s)throw new Error("Auth session missing!");return R(e,t,[{key:"access-token",value:s.access_token},{key:"refresh-token",value:s.refresh_token}].map((function(e){var t;return{name:"".concat(n.cookieName(),"-").concat(e.key),value:e.value,domain:n.cookieOptions.domain,maxAge:null!==(t=n.cookieOptions.lifetime)&&void 0!==t?t:0,path:n.cookieOptions.path,sameSite:n.cookieOptions.sameSite}})))}return"SIGNED_OUT"===i?R(e,t,["access-token","refresh-token"].map((function(e){return{name:"".concat(n.cookieName(),"-").concat(e),value:"",maxAge:-1}}))):t.getHeader("Set-Cookie")}},{key:"generateLink",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return J(this,void 0,void 0,a().mark((function r(){var i;return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,O(this.fetch,"".concat(this.url,"/admin/generate_link"),{type:e,email:t,password:n.password,data:n.data,redirect_to:n.redirectTo},{headers:this.headers});case 3:return i=r.sent,r.abrupt("return",{data:i,error:null});case 7:return r.prev=7,r.t0=r.catch(0),r.abrupt("return",{data:null,error:r.t0});case 10:case"end":return r.stop()}}),r,this,[[0,7]])})))}},{key:"createUser",value:function(e){return J(this,void 0,void 0,a().mark((function t(){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,O(this.fetch,"".concat(this.url,"/admin/users"),e,{headers:this.headers});case 3:return n=t.sent,t.abrupt("return",{user:n,data:n,error:null});case 7:return t.prev=7,t.t0=t.catch(0),t.abrupt("return",{user:null,data:null,error:t.t0});case 10:case"end":return t.stop()}}),t,this,[[0,7]])})))}},{key:"listUsers",value:function(){return J(this,void 0,void 0,a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,S(this.fetch,"".concat(this.url,"/admin/users"),{headers:this.headers});case 3:return t=e.sent,e.abrupt("return",{data:t.users,error:null});case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",{data:null,error:e.t0});case 10:case"end":return e.stop()}}),e,this,[[0,7]])})))}},{key:"getUserById",value:function(e){return J(this,void 0,void 0,a().mark((function t(){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,S(this.fetch,"".concat(this.url,"/admin/users/").concat(e),{headers:this.headers});case 3:return n=t.sent,t.abrupt("return",{data:n,error:null});case 7:return t.prev=7,t.t0=t.catch(0),t.abrupt("return",{data:null,error:t.t0});case 10:case"end":return t.stop()}}),t,this,[[0,7]])})))}},{key:"getUserByCookie",value:function(e,t){return J(this,void 0,void 0,a().mark((function n(){var r,i,s,o,c,u,h,l=this;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,e.cookies){n.next=3;break}throw new Error("Not able to parse cookies! When using Express make sure the cookie-parser middleware is in use!");case 3:if(r=e.cookies["".concat(this.cookieName(),"-access-token")],i=e.cookies["".concat(this.cookieName(),"-refresh-token")],r){n.next=7;break}throw new Error("No cookie found!");case 7:return n.next=9,this.getUser(r);case 9:if(s=n.sent,o=s.user,!s.error){n.next=29;break}if(i){n.next=15;break}throw new Error("No refresh_token cookie found!");case 15:if(t){n.next=17;break}throw new Error("You need to pass the res object to automatically refresh the session!");case 17:return n.next=19,this.refreshAccessToken(i);case 19:if(c=n.sent,u=c.data,!(h=c.error)){n.next=26;break}throw h;case 26:if(!u){n.next=29;break}return C(e,t,[{key:"access-token",value:u.access_token},{key:"refresh-token",value:u.refresh_token}].map((function(e){var t;return{name:"".concat(l.cookieName(),"-").concat(e.key),value:e.value,domain:l.cookieOptions.domain,maxAge:null!==(t=l.cookieOptions.lifetime)&&void 0!==t?t:0,path:l.cookieOptions.path,sameSite:l.cookieOptions.sameSite}}))),n.abrupt("return",{token:u.access_token,user:u.user,data:u.user,error:null});case 29:return n.abrupt("return",{token:r,user:o,data:o,error:null});case 32:return n.prev=32,n.t0=n.catch(0),n.abrupt("return",{token:null,user:null,data:null,error:n.t0});case 35:case"end":return n.stop()}}),n,this,[[0,32]])})))}},{key:"updateUserById",value:function(e,t){return J(this,void 0,void 0,a().mark((function n(){var r;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=4,E(this.fetch,"".concat(this.url,"/admin/users/").concat(e),t,{headers:this.headers});case 4:return r=n.sent,n.abrupt("return",{user:r,data:r,error:null});case 8:return n.prev=8,n.t0=n.catch(0),n.abrupt("return",{user:null,data:null,error:n.t0});case 11:case"end":return n.stop()}}),n,this,[[0,8]])})))}},{key:"deleteUser",value:function(e){return J(this,void 0,void 0,a().mark((function t(){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,j(this.fetch,"".concat(this.url,"/admin/users/").concat(e),{},{headers:this.headers});case 3:return n=t.sent,t.abrupt("return",{user:n,data:n,error:null});case 7:return t.prev=7,t.t0=t.catch(0),t.abrupt("return",{user:null,data:null,error:t.t0});case 10:case"end":return t.stop()}}),t,this,[[0,7]])})))}},{key:"getUser",value:function(e){return J(this,void 0,void 0,a().mark((function t(){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,S(this.fetch,"".concat(this.url,"/user"),{headers:this._createRequestHeaders(e)});case 3:return n=t.sent,t.abrupt("return",{user:n,data:n,error:null});case 7:return t.prev=7,t.t0=t.catch(0),t.abrupt("return",{user:null,data:null,error:t.t0});case 10:case"end":return t.stop()}}),t,this,[[0,7]])})))}},{key:"updateUser",value:function(e,t){return J(this,void 0,void 0,a().mark((function n(){var r;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,E(this.fetch,"".concat(this.url,"/user"),t,{headers:this._createRequestHeaders(e)});case 3:return r=n.sent,n.abrupt("return",{user:r,data:r,error:null});case 7:return n.prev=7,n.t0=n.catch(0),n.abrupt("return",{user:null,data:null,error:n.t0});case 10:case"end":return n.stop()}}),n,this,[[0,7]])})))}}]),e}();n(5743);var G=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(t){s(t)}}function a(e){try{c(r.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();var H={url:"http://localhost:9999",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,multiTab:!0,headers:v},F=function(){function e(t){r(this,e),this.stateChangeEmitters=new Map,this.networkRetries=0;var n=Object.assign(Object.assign({},H),t);this.currentUser=null,this.currentSession=null,this.autoRefreshToken=n.autoRefreshToken,this.persistSession=n.persistSession,this.multiTab=n.multiTab,this.localStorage=n.localStorage||globalThis.localStorage,this.api=new M({url:n.url,headers:n.headers,cookieOptions:n.cookieOptions,fetch:n.fetch}),this._recoverSession(),this._recoverAndRefresh(),this._listenForMultiTabEvents(),this._handleVisibilityChange(),n.detectSessionInUrl&&U()&&N("access_token")&&this.getSessionFromUrl({storeSession:!0}).then((function(e){if(e.error)throw new Error("Error getting session from URL.")}))}return s(e,[{key:"signUp",value:function(e){var t=e.email,n=e.password,r=e.phone,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return G(this,void 0,void 0,a().mark((function e(){var s,o,c,u,h;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this._removeSession(),!r||!n){e.next=8;break}return e.next=5,this.api.signUpWithPhone(r,n,{data:i.data,captchaToken:i.captchaToken});case 5:e.t0=e.sent,e.next=11;break;case 8:return e.next=10,this.api.signUpWithEmail(t,n,{redirectTo:i.redirectTo,data:i.data,captchaToken:i.captchaToken});case 10:e.t0=e.sent;case 11:if(s=e.t0,o=s.data,!(c=s.error)){e.next=16;break}throw c;case 16:if(o){e.next=18;break}throw"An error occurred on sign up.";case 18:return u=null,h=null,o.access_token&&(h=(u=o).user,this._saveSession(u),this._notifyAllSubscribers("SIGNED_IN")),o.id&&(h=o),e.abrupt("return",{user:h,session:u,error:null});case 25:return e.prev=25,e.t1=e.catch(0),e.abrupt("return",{user:null,session:null,error:e.t1});case 28:case"end":return e.stop()}}),e,this,[[0,25]])})))}},{key:"signIn",value:function(e){var t=e.email,n=e.phone,r=e.password,i=e.refreshToken,s=e.provider,o=e.oidc,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return G(this,void 0,void 0,a().mark((function e(){var u,h,l,f,d,v;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this._removeSession(),!t||r){e.next=8;break}return e.next=5,this.api.sendMagicLinkEmail(t,{redirectTo:c.redirectTo,shouldCreateUser:c.shouldCreateUser,captchaToken:c.captchaToken});case 5:return u=e.sent,h=u.error,e.abrupt("return",{user:null,session:null,error:h});case 8:if(!t||!r){e.next=10;break}return e.abrupt("return",this._handleEmailSignIn(t,r,{redirectTo:c.redirectTo}));case 10:if(!n||r){e.next=16;break}return e.next=13,this.api.sendMobileOTP(n,{shouldCreateUser:c.shouldCreateUser,captchaToken:c.captchaToken});case 13:return l=e.sent,f=l.error,e.abrupt("return",{user:null,session:null,error:f});case 16:if(!n||!r){e.next=18;break}return e.abrupt("return",this._handlePhoneSignIn(n,r));case 18:if(!i){e.next=26;break}return e.next=21,this._callRefreshToken(i);case 21:if(d=e.sent,!(v=d.error)){e.next=25;break}throw v;case 25:return e.abrupt("return",{user:this.currentUser,session:this.currentSession,error:null});case 26:if(!s){e.next=28;break}return e.abrupt("return",this._handleProviderSignIn(s,{redirectTo:c.redirectTo,scopes:c.scopes,queryParams:c.queryParams}));case 28:if(!o){e.next=30;break}return e.abrupt("return",this._handleOpenIDConnectSignIn(o));case 30:throw new Error("You must provide either an email, phone number, a third-party provider or OpenID Connect.");case 33:return e.prev=33,e.t0=e.catch(0),e.abrupt("return",{user:null,session:null,error:e.t0});case 36:case"end":return e.stop()}}),e,this,[[0,33]])})))}},{key:"verifyOTP",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return G(this,void 0,void 0,a().mark((function n(){var r,i,s,o,c;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,this._removeSession(),n.next=4,this.api.verifyOTP(e,t);case 4:if(r=n.sent,i=r.data,!(s=r.error)){n.next=9;break}throw s;case 9:if(i){n.next=11;break}throw"An error occurred on token verification.";case 11:return o=null,c=null,i.access_token&&(c=(o=i).user,this._saveSession(o),this._notifyAllSubscribers("SIGNED_IN")),i.id&&(c=i),n.abrupt("return",{user:c,session:o,error:null});case 18:return n.prev=18,n.t0=n.catch(0),n.abrupt("return",{user:null,session:null,error:n.t0});case 21:case"end":return n.stop()}}),n,this,[[0,18]])})))}},{key:"user",value:function(){return this.currentUser}},{key:"session",value:function(){return this.currentSession}},{key:"refreshSession",value:function(){var e;return G(this,void 0,void 0,a().mark((function t(){var n,r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,null===(e=this.currentSession)||void 0===e?void 0:e.access_token){t.next=3;break}throw new Error("Not logged in.");case 3:return t.next=5,this._callRefreshToken();case 5:if(n=t.sent,!(r=n.error)){t.next=9;break}throw r;case 9:return t.abrupt("return",{data:this.currentSession,user:this.currentUser,error:null});case 12:return t.prev=12,t.t0=t.catch(0),t.abrupt("return",{data:null,user:null,error:t.t0});case 15:case"end":return t.stop()}}),t,this,[[0,12]])})))}},{key:"update",value:function(e){var t;return G(this,void 0,void 0,a().mark((function n(){var r,i,s,o;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,null===(t=this.currentSession)||void 0===t?void 0:t.access_token){n.next=3;break}throw new Error("Not logged in.");case 3:return n.next=5,this.api.updateUser(this.currentSession.access_token,e);case 5:if(r=n.sent,i=r.user,!(s=r.error)){n.next=10;break}throw s;case 10:if(i){n.next=12;break}throw Error("Invalid user data.");case 12:return o=Object.assign(Object.assign({},this.currentSession),{user:i}),this._saveSession(o),this._notifyAllSubscribers("USER_UPDATED"),n.abrupt("return",{data:i,user:i,error:null});case 18:return n.prev=18,n.t0=n.catch(0),n.abrupt("return",{data:null,user:null,error:n.t0});case 21:case"end":return n.stop()}}),n,this,[[0,18]])})))}},{key:"setSession",value:function(e){return G(this,void 0,void 0,a().mark((function t(){var n,r,i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e){t.next=3;break}throw new Error("No current session.");case 3:return t.next=5,this.api.refreshAccessToken(e);case 5:if(n=t.sent,r=n.data,!(i=n.error)){t.next=10;break}return t.abrupt("return",{session:null,error:i});case 10:return this._saveSession(r),this._notifyAllSubscribers("SIGNED_IN"),t.abrupt("return",{session:r,error:null});case 15:return t.prev=15,t.t0=t.catch(0),t.abrupt("return",{error:t.t0,session:null});case 18:case"end":return t.stop()}}),t,this,[[0,15]])})))}},{key:"setAuth",value:function(e){return this.currentSession=Object.assign(Object.assign({},this.currentSession),{access_token:e,token_type:"bearer",user:this.user()}),this._notifyAllSubscribers("TOKEN_REFRESHED"),this.currentSession}},{key:"getSessionFromUrl",value:function(e){return G(this,void 0,void 0,a().mark((function t(){var n,r,i,s,o,c,u,h,l,f,d,v,p;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,U()){t.next=3;break}throw new Error("No browser detected.");case 3:if(!(n=N("error_description"))){t.next=6;break}throw new Error(n);case 6:if(r=N("provider_token"),i=N("access_token")){t.next=10;break}throw new Error("No access_token detected.");case 10:if(s=N("expires_in")){t.next=13;break}throw new Error("No expires_in detected.");case 13:if(o=N("refresh_token")){t.next=16;break}throw new Error("No refresh_token detected.");case 16:if(c=N("token_type")){t.next=19;break}throw new Error("No token_type detected.");case 19:return u=Math.round(Date.now()/1e3),h=u+parseInt(s),t.next=23,this.api.getUser(i);case 23:if(l=t.sent,f=l.user,!(d=l.error)){t.next=28;break}throw d;case 28:return v={provider_token:r,access_token:i,expires_in:parseInt(s),expires_at:h,refresh_token:o,token_type:c,user:f},(null==e?void 0:e.storeSession)&&(this._saveSession(v),p=N("type"),this._notifyAllSubscribers("SIGNED_IN"),"recovery"===p&&this._notifyAllSubscribers("PASSWORD_RECOVERY")),window.location.hash="",t.abrupt("return",{data:v,error:null});case 34:return t.prev=34,t.t0=t.catch(0),t.abrupt("return",{data:null,error:t.t0});case 37:case"end":return t.stop()}}),t,this,[[0,34]])})))}},{key:"signOut",value:function(){var e;return G(this,void 0,void 0,a().mark((function t(){var n,r,i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=null===(e=this.currentSession)||void 0===e?void 0:e.access_token,this._removeSession(),this._notifyAllSubscribers("SIGNED_OUT"),!n){t.next=10;break}return t.next=6,this.api.signOut(n);case 6:if(r=t.sent,!(i=r.error)){t.next=10;break}return t.abrupt("return",{error:i});case 10:return t.abrupt("return",{error:null});case 11:case"end":return t.stop()}}),t,this)})))}},{key:"onAuthStateChange",value:function(e){var t=this;try{var n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),r={id:n,callback:e,unsubscribe:function(){t.stateChangeEmitters.delete(n)}};return this.stateChangeEmitters.set(n,r),{data:r,error:null}}catch(i){return{data:null,error:i}}}},{key:"_handleEmailSignIn",value:function(e,t){var n,r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return G(this,void 0,void 0,a().mark((function s(){var o,c,u;return a().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,this.api.signInWithEmail(e,t,{redirectTo:i.redirectTo});case 3:if(o=s.sent,c=o.data,!(u=o.error)&&c){s.next=8;break}return s.abrupt("return",{data:null,user:null,session:null,error:u});case 8:return((null===(n=null==c?void 0:c.user)||void 0===n?void 0:n.confirmed_at)||(null===(r=null==c?void 0:c.user)||void 0===r?void 0:r.email_confirmed_at))&&(this._saveSession(c),this._notifyAllSubscribers("SIGNED_IN")),s.abrupt("return",{data:c,user:c.user,session:c,error:null});case 12:return s.prev=12,s.t0=s.catch(0),s.abrupt("return",{data:null,user:null,session:null,error:s.t0});case 15:case"end":return s.stop()}}),s,this,[[0,12]])})))}},{key:"_handlePhoneSignIn",value:function(e,t){var n;return G(this,void 0,void 0,a().mark((function r(){var i,s,o;return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,this.api.signInWithPhone(e,t);case 3:if(i=r.sent,s=i.data,!(o=i.error)&&s){r.next=8;break}return r.abrupt("return",{data:null,user:null,session:null,error:o});case 8:return(null===(n=null==s?void 0:s.user)||void 0===n?void 0:n.phone_confirmed_at)&&(this._saveSession(s),this._notifyAllSubscribers("SIGNED_IN")),r.abrupt("return",{data:s,user:s.user,session:s,error:null});case 12:return r.prev=12,r.t0=r.catch(0),r.abrupt("return",{data:null,user:null,session:null,error:r.t0});case 15:case"end":return r.stop()}}),r,this,[[0,12]])})))}},{key:"_handleProviderSignIn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.api.getUrlForProvider(e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});try{return U()&&(window.location.href=n),{provider:e,url:n,data:null,session:null,user:null,error:null}}catch(r){return n?{provider:e,url:n,data:null,session:null,user:null,error:null}:{data:null,user:null,session:null,error:r}}}},{key:"_handleOpenIDConnectSignIn",value:function(e){var t=e.id_token,n=e.nonce,r=e.client_id,i=e.issuer,s=e.provider;return G(this,void 0,void 0,a().mark((function e(){var o,c,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t&&n&&(r&&i||s))){e.next=17;break}return e.prev=1,e.next=4,this.api.signInWithOpenIDConnect({id_token:t,nonce:n,client_id:r,issuer:i,provider:s});case 4:if(o=e.sent,c=o.data,!(u=o.error)&&c){e.next=9;break}return e.abrupt("return",{user:null,session:null,error:u});case 9:return this._saveSession(c),this._notifyAllSubscribers("SIGNED_IN"),e.abrupt("return",{user:c.user,session:c,error:null});case 14:return e.prev=14,e.t0=e.catch(1),e.abrupt("return",{user:null,session:null,error:e.t0});case 17:throw new Error("You must provide a OpenID Connect provider with your id token and nonce.");case 18:case"end":return e.stop()}}),e,this,[[1,14]])})))}},{key:"_recoverSession",value:function(){try{var e=function(e,t){var n=U()&&(null==e?void 0:e.getItem(t));if(!n||"string"!=typeof n)return null;try{return JSON.parse(n)}catch(r){return n}}(this.localStorage,y);if(!e)return null;var t=e.currentSession;e.expiresAt>=Math.round(Date.now()/1e3)+10&&(null==t?void 0:t.user)&&(this._saveSession(t),this._notifyAllSubscribers("SIGNED_IN"))}catch(n){console.log("error",n)}}},{key:"_recoverAndRefresh",value:function(){return G(this,void 0,void 0,a().mark((function e(){var t,n,r,i,s,o,c=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,B(this.localStorage,y);case 3:if(t=e.sent){e.next=6;break}return e.abrupt("return",null);case 6:if(n=t.currentSession,r=t.expiresAt,i=Math.round(Date.now()/1e3),!(r<i+10)){e.next=29;break}if(!this.autoRefreshToken||!n.refresh_token){e.next=26;break}return this.networkRetries++,e.next=13,this._callRefreshToken(n.refresh_token);case 13:if(s=e.sent,!(o=s.error)){e.next=23;break}if(console.log(o.message),!(o.message===p&&this.networkRetries<k)){e.next=21;break}return this.refreshTokenTimer&&clearTimeout(this.refreshTokenTimer),this.refreshTokenTimer=setTimeout((function(){return c._recoverAndRefresh()}),100*Math.pow(m,this.networkRetries)),e.abrupt("return");case 21:return e.next=23,this._removeSession();case 23:this.networkRetries=0,e.next=27;break;case 26:this._removeSession();case 27:e.next=30;break;case 29:n?(this._saveSession(n),this._notifyAllSubscribers("SIGNED_IN")):(console.log("Current session is missing data."),this._removeSession());case 30:e.next=36;break;case 32:return e.prev=32,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 36:case"end":return e.stop()}}),e,this,[[0,32]])})))}},{key:"_callRefreshToken",value:function(e){var t;return void 0===e&&(e=null===(t=this.currentSession)||void 0===t?void 0:t.refresh_token),G(this,void 0,void 0,a().mark((function t(){var n,r,i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e){t.next=3;break}throw new Error("No current session.");case 3:return t.next=5,this.api.refreshAccessToken(e);case 5:if(n=t.sent,r=n.data,!(i=n.error)){t.next=10;break}throw i;case 10:if(r){t.next=12;break}throw Error("Invalid session data.");case 12:return this._saveSession(r),this._notifyAllSubscribers("TOKEN_REFRESHED"),this._notifyAllSubscribers("SIGNED_IN"),t.abrupt("return",{data:r,error:null});case 18:return t.prev=18,t.t0=t.catch(0),t.abrupt("return",{data:null,error:t.t0});case 21:case"end":return t.stop()}}),t,this,[[0,18]])})))}},{key:"_notifyAllSubscribers",value:function(e){var t=this;this.stateChangeEmitters.forEach((function(n){return n.callback(e,t.currentSession)}))}},{key:"_saveSession",value:function(e){this.currentSession=e,this.currentUser=e.user;var t=e.expires_at;if(t){var n=t-Math.round(Date.now()/1e3),r=n>10?10:.5;this._startAutoRefreshToken(1e3*(n-r))}this.persistSession&&e.expires_at&&this._persistSession(this.currentSession)}},{key:"_persistSession",value:function(e){var t={currentSession:e,expiresAt:e.expires_at};!function(e,t,n){I(void 0,void 0,void 0,a().mark((function r(){return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.t0=U(),!r.t0){r.next=4;break}return r.next=4,null==e?void 0:e.setItem(t,JSON.stringify(n));case 4:case"end":return r.stop()}}),r)})))}(this.localStorage,y,t)}},{key:"_removeSession",value:function(){return G(this,void 0,void 0,a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.currentSession=null,this.currentUser=null,this.refreshTokenTimer&&clearTimeout(this.refreshTokenTimer),L(this.localStorage,y);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"_startAutoRefreshToken",value:function(e){var t=this;this.refreshTokenTimer&&clearTimeout(this.refreshTokenTimer),e<=0||!this.autoRefreshToken||(this.refreshTokenTimer=setTimeout((function(){return G(t,void 0,void 0,a().mark((function e(){var t,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.networkRetries++,e.next=3,this._callRefreshToken();case 3:t=e.sent,(n=t.error)||(this.networkRetries=0),(null==n?void 0:n.message)===p&&this.networkRetries<k&&this._startAutoRefreshToken(100*Math.pow(m,this.networkRetries));case 7:case"end":return e.stop()}}),e,this)})))}),e),"function"==typeof this.refreshTokenTimer.unref&&this.refreshTokenTimer.unref())}},{key:"_listenForMultiTabEvents",value:function(){var e=this;if(!this.multiTab||!U()||!(null===window||void 0===window?void 0:window.addEventListener))return!1;try{null===window||void 0===window||window.addEventListener("storage",(function(t){var n;if(t.key===y){var r=JSON.parse(String(t.newValue));(null===(n=null==r?void 0:r.currentSession)||void 0===n?void 0:n.access_token)?(e._saveSession(r.currentSession),e._notifyAllSubscribers("SIGNED_IN")):(e._removeSession(),e._notifyAllSubscribers("SIGNED_OUT"))}}))}catch(t){console.error("_listenForMultiTabEvents",t)}}},{key:"_handleVisibilityChange",value:function(){var e=this;if(!this.multiTab||!U()||!(null===window||void 0===window?void 0:window.addEventListener))return!1;try{null===window||void 0===window||window.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&e._recoverAndRefresh()}))}catch(t){console.error("_handleVisibilityChange",t)}}}]),e}();function z(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f(this,n)}}var q=function(e){h(n,e);var t=z(n);function n(e){return r(this,n),t.call(this,e)}return s(n)}(F),K=n(2982),W=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(t){s(t)}}function a(e){try{c(r.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))},X=function(){function e(t){var i,s=this;r(this,e),Object.assign(this,t),i=t.fetch?t.fetch:"undefined"==typeof fetch?function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return W(s,void 0,void 0,a().mark((function e(){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.e(944).then(n.t.bind(n,4944,23));case 2:return e.next=4,(r=e.sent).fetch.apply(r,t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})))}:fetch,this.fetch=function(){return i.apply(void 0,arguments)},this.shouldThrowOnError=t.shouldThrowOnError||!1,this.allowEmpty=t.allowEmpty||!1}return s(e,[{key:"throwOnError",value:function(e){return null==e&&(e=!0),this.shouldThrowOnError=e,this}},{key:"then",value:function(e,t){var n=this;void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");var r=this.fetch(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then((function(e){return W(n,void 0,void 0,a().mark((function t(){var n,r,i,s,o,c,u,h,l,f,d,v,p,k,m;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=null,c=null,u=null,h=e.status,l=e.statusText,!e.ok){t.next=17;break}if(f=null===(n=this.headers.Prefer)||void 0===n?void 0:n.split(",").includes("return=minimal"),"HEAD"===this.method||f){t.next=12;break}return t.next=10,e.text();case 10:(d=t.sent)&&(c="text/csv"===this.headers.Accept?d:JSON.parse(d));case 12:v=null===(r=this.headers.Prefer)||void 0===r?void 0:r.match(/count=(exact|planned|estimated)/),p=null===(i=e.headers.get("content-range"))||void 0===i?void 0:i.split("/"),v&&p&&p.length>1&&(u=parseInt(p[1])),t.next=24;break;case 17:return t.next=19,e.text();case 19:k=t.sent;try{o=JSON.parse(k)}catch(a){o={message:k}}if(o&&this.allowEmpty&&(null===(s=null==o?void 0:o.details)||void 0===s?void 0:s.includes("Results contain 0 rows"))&&(o=null,h=200,l="OK"),!o||!this.shouldThrowOnError){t.next=24;break}throw o;case 24:return m={error:o,data:c,count:u,status:h,statusText:l,body:c},t.abrupt("return",m);case 26:case"end":return t.stop()}}),t,this)})))}));return this.shouldThrowOnError||(r=r.catch((function(e){return{error:{message:"FetchError: ".concat(e.message),details:"",hint:"",code:e.code||""},data:null,body:null,count:null,status:400,statusText:"Bad Request"}}))),r.then(e,t)}}]),e}();function Y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f(this,n)}}var V=function(e){h(n,e);var t=Y(n);function n(){return r(this,n),t.apply(this,arguments)}return s(n,[{key:"select",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"*",t=!1,n=e.split("").map((function(e){return/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)})).join("");return this.url.searchParams.set("select",n),this}},{key:"order",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.ascending,r=void 0===n||n,i=t.nullsFirst,s=void 0!==i&&i,o=t.foreignTable,a=void 0===o?"order":"".concat(o,".order"),c=this.url.searchParams.get(a);return this.url.searchParams.set(a,"".concat(c?"".concat(c,","):"").concat(e,".").concat(r?"asc":"desc",".").concat(s?"nullsfirst":"nullslast")),this}},{key:"limit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.foreignTable,r=void 0===n?"limit":"".concat(n,".limit");return this.url.searchParams.set(r,"".concat(e)),this}},{key:"range",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.foreignTable,i=void 0===r?"offset":"".concat(r,".offset"),s=void 0===r?"limit":"".concat(r,".limit");return this.url.searchParams.set(i,"".concat(e)),this.url.searchParams.set(s,"".concat(t-e+1)),this}},{key:"abortSignal",value:function(e){return this.signal=e,this}},{key:"single",value:function(){return this.headers.Accept="application/vnd.pgrst.object+json",this}},{key:"maybeSingle",value:function(){return this.headers.Accept="application/vnd.pgrst.object+json",this.allowEmpty=!0,this}},{key:"csv",value:function(){return this.headers.Accept="text/csv",this}}]),n}(X);function Z(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f(this,n)}}var $=function(e){h(n,e);var t=Z(n);function n(){var e;return r(this,n),(e=t.apply(this,arguments)).cs=e.contains,e.cd=e.containedBy,e.sl=e.rangeLt,e.sr=e.rangeGt,e.nxl=e.rangeGte,e.nxr=e.rangeLte,e.adj=e.rangeAdjacent,e.ov=e.overlaps,e}return s(n,[{key:"not",value:function(e,t,n){return this.url.searchParams.append("".concat(e),"not.".concat(t,".").concat(n)),this}},{key:"or",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.foreignTable,r=void 0===n?"or":"".concat(n,".or");return this.url.searchParams.append(r,"(".concat(e,")")),this}},{key:"eq",value:function(e,t){return this.url.searchParams.append("".concat(e),"eq.".concat(t)),this}},{key:"neq",value:function(e,t){return this.url.searchParams.append("".concat(e),"neq.".concat(t)),this}},{key:"gt",value:function(e,t){return this.url.searchParams.append("".concat(e),"gt.".concat(t)),this}},{key:"gte",value:function(e,t){return this.url.searchParams.append("".concat(e),"gte.".concat(t)),this}},{key:"lt",value:function(e,t){return this.url.searchParams.append("".concat(e),"lt.".concat(t)),this}},{key:"lte",value:function(e,t){return this.url.searchParams.append("".concat(e),"lte.".concat(t)),this}},{key:"like",value:function(e,t){return this.url.searchParams.append("".concat(e),"like.".concat(t)),this}},{key:"ilike",value:function(e,t){return this.url.searchParams.append("".concat(e),"ilike.".concat(t)),this}},{key:"is",value:function(e,t){return this.url.searchParams.append("".concat(e),"is.".concat(t)),this}},{key:"in",value:function(e,t){var n=t.map((function(e){return"string"==typeof e&&new RegExp("[,()]").test(e)?'"'.concat(e,'"'):"".concat(e)})).join(",");return this.url.searchParams.append("".concat(e),"in.(".concat(n,")")),this}},{key:"contains",value:function(e,t){return"string"==typeof t?this.url.searchParams.append("".concat(e),"cs.".concat(t)):Array.isArray(t)?this.url.searchParams.append("".concat(e),"cs.{".concat(t.join(","),"}")):this.url.searchParams.append("".concat(e),"cs.".concat(JSON.stringify(t))),this}},{key:"containedBy",value:function(e,t){return"string"==typeof t?this.url.searchParams.append("".concat(e),"cd.".concat(t)):Array.isArray(t)?this.url.searchParams.append("".concat(e),"cd.{".concat(t.join(","),"}")):this.url.searchParams.append("".concat(e),"cd.".concat(JSON.stringify(t))),this}},{key:"rangeLt",value:function(e,t){return this.url.searchParams.append("".concat(e),"sl.".concat(t)),this}},{key:"rangeGt",value:function(e,t){return this.url.searchParams.append("".concat(e),"sr.".concat(t)),this}},{key:"rangeGte",value:function(e,t){return this.url.searchParams.append("".concat(e),"nxl.".concat(t)),this}},{key:"rangeLte",value:function(e,t){return this.url.searchParams.append("".concat(e),"nxr.".concat(t)),this}},{key:"rangeAdjacent",value:function(e,t){return this.url.searchParams.append("".concat(e),"adj.".concat(t)),this}},{key:"overlaps",value:function(e,t){return"string"==typeof t?this.url.searchParams.append("".concat(e),"ov.".concat(t)):this.url.searchParams.append("".concat(e),"ov.{".concat(t.join(","),"}")),this}},{key:"textSearch",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.config,i=n.type,s=void 0===i?null:i,o="";"plain"===s?o="pl":"phrase"===s?o="ph":"websearch"===s&&(o="w");var a=void 0===r?"":"(".concat(r,")");return this.url.searchParams.append("".concat(e),"".concat(o,"fts").concat(a,".").concat(t)),this}},{key:"fts",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.config,i=void 0===r?"":"(".concat(r,")");return this.url.searchParams.append("".concat(e),"fts".concat(i,".").concat(t)),this}},{key:"plfts",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.config,i=void 0===r?"":"(".concat(r,")");return this.url.searchParams.append("".concat(e),"plfts".concat(i,".").concat(t)),this}},{key:"phfts",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.config,i=void 0===r?"":"(".concat(r,")");return this.url.searchParams.append("".concat(e),"phfts".concat(i,".").concat(t)),this}},{key:"wfts",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.config,i=void 0===r?"":"(".concat(r,")");return this.url.searchParams.append("".concat(e),"wfts".concat(i,".").concat(t)),this}},{key:"filter",value:function(e,t,n){return this.url.searchParams.append("".concat(e),"".concat(t,".").concat(n)),this}},{key:"match",value:function(e){var t=this;return Object.keys(e).forEach((function(n){t.url.searchParams.append("".concat(n),"eq.".concat(e[n]))})),this}}]),n}(V);function Q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f(this,n)}}var ee=function(e){h(n,e);var t=Q(n);function n(e){var i,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=s.headers,a=void 0===o?{}:o,c=s.schema,u=s.fetch,h=s.shouldThrowOnError;return r(this,n),(i=t.call(this,{fetch:u,shouldThrowOnError:h})).url=new URL(e),i.headers=Object.assign({},a),i.schema=c,i}return s(n,[{key:"select",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"*",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.head,r=void 0!==n&&n,i=t.count,s=void 0===i?null:i;this.method="GET";var o=!1,a=e.split("").map((function(e){return/\s/.test(e)&&!o?"":('"'===e&&(o=!o),e)})).join("");return this.url.searchParams.set("select",a),s&&(this.headers.Prefer="count=".concat(s)),r&&(this.method="HEAD"),new $(this)}},{key:"insert",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.upsert,r=void 0!==n&&n,i=t.onConflict,s=t.returning,o=void 0===s?"representation":s,a=t.count,c=void 0===a?null:a;this.method="POST";var u=["return=".concat(o)];if(r&&u.push("resolution=merge-duplicates"),r&&void 0!==i&&this.url.searchParams.set("on_conflict",i),this.body=e,c&&u.push("count=".concat(c)),this.headers.Prefer&&u.unshift(this.headers.Prefer),this.headers.Prefer=u.join(","),Array.isArray(e)){var h=e.reduce((function(e,t){return e.concat(Object.keys(t))}),[]);if(h.length>0){var l=(0,K.Z)(new Set(h)).map((function(e){return'"'.concat(e,'"')}));this.url.searchParams.set("columns",l.join(","))}}return new $(this)}},{key:"upsert",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.onConflict,r=t.returning,i=void 0===r?"representation":r,s=t.count,o=void 0===s?null:s,a=t.ignoreDuplicates,c=void 0!==a&&a;this.method="POST";var u=["resolution=".concat(c?"ignore":"merge","-duplicates"),"return=".concat(i)];return void 0!==n&&this.url.searchParams.set("on_conflict",n),this.body=e,o&&u.push("count=".concat(o)),this.headers.Prefer&&u.unshift(this.headers.Prefer),this.headers.Prefer=u.join(","),new $(this)}},{key:"update",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.returning,r=void 0===n?"representation":n,i=t.count,s=void 0===i?null:i;this.method="PATCH";var o=["return=".concat(r)];return this.body=e,s&&o.push("count=".concat(s)),this.headers.Prefer&&o.unshift(this.headers.Prefer),this.headers.Prefer=o.join(","),new $(this)}},{key:"delete",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.returning,n=void 0===t?"representation":t,r=e.count,i=void 0===r?null:r;this.method="DELETE";var s=["return=".concat(n)];return i&&s.push("count=".concat(i)),this.headers.Prefer&&s.unshift(this.headers.Prefer),this.headers.Prefer=s.join(","),new $(this)}}]),n}(X),te=n(885);function ne(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f(this,n)}}var re,ie=function(e){h(n,e);var t=ne(n);function n(e){var i,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=s.headers,a=void 0===o?{}:o,c=s.schema,u=s.fetch,h=s.shouldThrowOnError;return r(this,n),(i=t.call(this,{fetch:u,shouldThrowOnError:h})).url=new URL(e),i.headers=Object.assign({},a),i.schema=c,i}return s(n,[{key:"rpc",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.head,i=void 0!==r&&r,s=n.count,o=void 0===s?null:s;return i?(this.method="HEAD",e&&Object.entries(e).forEach((function(e){var n=(0,te.Z)(e,2),r=n[0],i=n[1];t.url.searchParams.append(r,i)}))):(this.method="POST",this.body=e),o&&(void 0!==this.headers.Prefer?this.headers.Prefer+=",count=".concat(o):this.headers.Prefer="count=".concat(o)),new $(this)}}]),n}(X),se={"X-Client-Info":"postgrest-js/".concat("0.37.4")},oe=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.headers,s=void 0===i?{}:i,o=n.schema,a=n.fetch,c=n.throwOnError;r(this,e),this.url=t,this.headers=Object.assign(Object.assign({},se),s),this.schema=o,this.fetch=a,this.shouldThrowOnError=c}return s(e,[{key:"auth",value:function(e){return this.headers.Authorization="Bearer ".concat(e),this}},{key:"from",value:function(e){var t="".concat(this.url,"/").concat(e);return new ee(t,{headers:this.headers,schema:this.schema,fetch:this.fetch,shouldThrowOnError:this.shouldThrowOnError})}},{key:"rpc",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.head,i=void 0!==r&&r,s=n.count,o=void 0===s?null:s,a="".concat(this.url,"/rpc/").concat(e);return new ie(a,{headers:this.headers,schema:this.schema,fetch:this.fetch,shouldThrowOnError:this.shouldThrowOnError}).rpc(t,{head:i,count:o})}}]),e}();!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}(re||(re={}));var ae,ce,ue,he,le,fe=function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=null!==(n=r.skipTypes)&&void 0!==n?n:[];return Object.keys(t).reduce((function(n,r){return n[r]=de(r,e,t,i),n}),{})},de=function(e,t,n,r){var i=t.find((function(t){return t.name===e})),s=null==i?void 0:i.type,o=n[e];return s&&!r.includes(s)?ve(s,o):pe(o)},ve=function(e,t){if("_"===e.charAt(0)){var n=e.slice(1,e.length);return be(t,n)}switch(e){case re.bool:return ke(t);case re.float4:case re.float8:case re.int2:case re.int4:case re.int8:case re.numeric:case re.oid:return me(t);case re.json:case re.jsonb:return ye(t);case re.timestamp:return ge(t);case re.abstime:case re.date:case re.daterange:case re.int4range:case re.int8range:case re.money:case re.reltime:case re.text:case re.time:case re.timestamptz:case re.timetz:case re.tsrange:case re.tstzrange:default:return pe(t)}},pe=function(e){return e},ke=function(e){switch(e){case"t":return!0;case"f":return!1;default:return e}},me=function(e){if("string"==typeof e){var t=parseFloat(e);if(!Number.isNaN(t))return t}return e},ye=function(e){if("string"==typeof e)try{return JSON.parse(e)}catch(t){return console.log("JSON parse error: ".concat(t)),e}return e},be=function(e,t){if("string"!=typeof e)return e;var n=e.length-1,r=e[n];if("{"===e[0]&&"}"===r){var i,s=e.slice(1,n);try{i=JSON.parse("["+s+"]")}catch(o){i=s?s.split(","):[]}return i.map((function(e){return ve(t,e)}))}return e},ge=function(e){return"string"==typeof e?e.replace(" ","T"):e},we=n(2960),xe={"X-Client-Info":"realtime-js/".concat("1.7.3")},_e=1e4;!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(ae||(ae={})),function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"}(ce||(ce={})),function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}(ue||(ue={})),function(e){e.websocket="websocket"}(he||(he={})),function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}(le||(le={}));var Te=function(){function e(t,n){r(this,e),this.callback=t,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=n}return s(e,[{key:"reset",value:function(){this.tries=0,clearTimeout(this.timer)}},{key:"scheduleTimeout",value:function(){var e=this;clearTimeout(this.timer),this.timer=setTimeout((function(){e.tries=e.tries+1,e.callback()}),this.timerCalc(this.tries+1))}}]),e}(),Se=function(){function e(){r(this,e),this.HEADER_LENGTH=1}return s(e,[{key:"decode",value:function(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}},{key:"_binaryDecode",value:function(e){var t=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,t,n)}},{key:"_decodeBroadcast",value:function(e,t,n){var r=t.getUint8(1),i=t.getUint8(2),s=this.HEADER_LENGTH+2,o=n.decode(e.slice(s,s+r));s+=r;var a=n.decode(e.slice(s,s+i));return s+=i,{ref:null,topic:o,event:a,payload:JSON.parse(n.decode(e.slice(s,e.byteLength)))}}}]),e}(),Oe=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_e;r(this,e),this.channel=t,this.event=n,this.payload=i,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}return s(e,[{key:"resend",value:function(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}},{key:"send",value:function(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref}))}},{key:"updatePayload",value:function(e){this.payload=Object.assign(Object.assign({},this.payload),e)}},{key:"receive",value:function(e,t){var n;return this._hasReceived(e)&&t(null===(n=this.receivedResp)||void 0===n?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}},{key:"startTimeout",value:function(){var e=this;if(!this.timeoutTimer){this.ref=this.channel.socket.makeRef(),this.refEvent=this.channel.replyEventName(this.ref);var t=function(t){e._cancelRefEvent(),e._cancelTimeout(),e.receivedResp=t,e._matchReceive(t)};this.channel instanceof Ee?this.channel.on(this.refEvent,t):this.channel.on(this.refEvent,{},t),this.timeoutTimer=setTimeout((function(){e.trigger("timeout",{})}),this.timeout)}}},{key:"trigger",value:function(e,t){this.refEvent&&this.channel.trigger(this.refEvent,{status:e,response:t})}},{key:"destroy",value:function(){this._cancelRefEvent(),this._cancelTimeout()}},{key:"_cancelRefEvent",value:function(){this.refEvent&&(this.channel instanceof Ee?this.channel.off(this.refEvent):this.channel.off(this.refEvent,{}))}},{key:"_cancelTimeout",value:function(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}},{key:"_matchReceive",value:function(e){var t=e.status,n=e.response;this.recHooks.filter((function(e){return e.status===t})).forEach((function(e){return e.callback(n)}))}},{key:"_hasReceived",value:function(e){return this.receivedResp&&this.receivedResp.status===e}}]),e}(),Ee=function(){function e(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;r(this,e),this.topic=t,this.params=i,this.socket=s,this.bindings=[],this.state=ce.closed,this.joinedOnce=!1,this.pushBuffer=[],this.timeout=this.socket.timeout,this.joinPush=new Oe(this,ue.join,this.params,this.timeout),this.rejoinTimer=new Te((function(){return n.rejoinUntilConnected()}),this.socket.reconnectAfterMs),this.joinPush.receive("ok",(function(){n.state=ce.joined,n.rejoinTimer.reset(),n.pushBuffer.forEach((function(e){return e.send()})),n.pushBuffer=[]})),this.onClose((function(){n.rejoinTimer.reset(),n.socket.log("channel","close ".concat(n.topic," ").concat(n.joinRef())),n.state=ce.closed,n.socket.remove(n)})),this.onError((function(e){n.isLeaving()||n.isClosed()||(n.socket.log("channel","error ".concat(n.topic),e),n.state=ce.errored,n.rejoinTimer.scheduleTimeout())})),this.joinPush.receive("timeout",(function(){n.isJoining()&&(n.socket.log("channel","timeout ".concat(n.topic),n.joinPush.timeout),n.state=ce.errored,n.rejoinTimer.scheduleTimeout())})),this.on(ue.reply,(function(e,t){n.trigger(n.replyEventName(t),e)}))}return s(e,[{key:"rejoinUntilConnected",value:function(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this.rejoin()}},{key:"subscribe",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;if(this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";return this.joinedOnce=!0,this.rejoin(e),this.joinPush}},{key:"onClose",value:function(e){this.on(ue.close,e)}},{key:"onError",value:function(e){this.on(ue.error,(function(t){return e(t)}))}},{key:"on",value:function(e,t){this.bindings.push({event:e,callback:t})}},{key:"off",value:function(e){this.bindings=this.bindings.filter((function(t){return t.event!==e}))}},{key:"canPush",value:function(){return this.socket.isConnected()&&this.isJoined()}},{key:"push",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.timeout;if(!this.joinedOnce)throw"tried to push '".concat(e,"' to '").concat(this.topic,"' before joining. Use channel.subscribe() before pushing events");var r=new Oe(this,e,t,n);return this.canPush()?r.send():(r.startTimeout(),this.pushBuffer.push(r)),r}},{key:"updateJoinPayload",value:function(e){this.joinPush.updatePayload(e)}},{key:"unsubscribe",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this.state=ce.leaving;var n=function(){e.socket.log("channel","leave ".concat(e.topic)),e.trigger(ue.close,"leave",e.joinRef())};this.joinPush.destroy();var r=new Oe(this,ue.leave,{},t);return r.receive("ok",(function(){return n()})).receive("timeout",(function(){return n()})),r.send(),this.canPush()||r.trigger("ok",{}),r}},{key:"onMessage",value:function(e,t,n){return t}},{key:"isMember",value:function(e){return this.topic===e}},{key:"joinRef",value:function(){return this.joinPush.ref}},{key:"rejoin",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this.isLeaving()||(this.socket.leaveOpenTopic(this.topic),this.state=ce.joining,this.joinPush.resend(e))}},{key:"trigger",value:function(e,t,n){var r=ue.close,i=ue.error,s=ue.leave,o=ue.join;if(!(n&&[r,i,s,o].indexOf(e)>=0&&n!==this.joinRef())){var a=this.onMessage(e,t,n);if(t&&!a)throw"channel onMessage callbacks must return the payload, modified or unmodified";this.bindings.filter((function(n){return"*"===n.event?e===(null==t?void 0:t.type):n.event===e})).map((function(e){return e.callback(a,n)}))}}},{key:"replyEventName",value:function(e){return"chan_reply_".concat(e)}},{key:"isClosed",value:function(){return this.state===ce.closed}},{key:"isErrored",value:function(){return this.state===ce.errored}},{key:"isJoined",value:function(){return this.state===ce.joined}},{key:"isJoining",value:function(){return this.state===ce.joining}},{key:"isLeaving",value:function(){return this.state===ce.leaving}}]),e}(),je=function(){function e(t,n){var i=this;r(this,e),this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:function(){},onLeave:function(){},onSync:function(){}};var s=(null==n?void 0:n.events)||{state:"presence_state",diff:"presence_diff"};this.channel.on(s.state,{},(function(t){var n=i.caller,r=n.onJoin,s=n.onLeave,o=n.onSync;i.joinRef=i.channel.joinRef(),i.state=e.syncState(i.state,t,r,s),i.pendingDiffs.forEach((function(t){i.state=e.syncDiff(i.state,t,r,s)})),i.pendingDiffs=[],o()})),this.channel.on(s.diff,{},(function(t){var n=i.caller,r=n.onJoin,s=n.onLeave,o=n.onSync;i.inPendingSyncState()?i.pendingDiffs.push(t):(i.state=e.syncDiff(i.state,t,r,s),o())}))}return s(e,[{key:"onJoin",value:function(e){this.caller.onJoin=e}},{key:"onLeave",value:function(e){this.caller.onLeave=e}},{key:"onSync",value:function(e){this.caller.onSync=e}},{key:"list",value:function(t){return e.list(this.state,t)}},{key:"inPendingSyncState",value:function(){return!this.joinRef||this.joinRef!==this.channel.joinRef()}}],[{key:"syncState",value:function(e,t,n,r){var i=this.cloneDeep(e),s=this.transformState(t),o={},a={};return this.map(i,(function(e,t){s[e]||(a[e]=t)})),this.map(s,(function(e,t){var n=i[e];if(n){var r=t.map((function(e){return e.presence_id})),s=n.map((function(e){return e.presence_id})),c=t.filter((function(e){return s.indexOf(e.presence_id)<0})),u=n.filter((function(e){return r.indexOf(e.presence_id)<0}));c.length>0&&(o[e]=c),u.length>0&&(a[e]=u)}else o[e]=t})),this.syncDiff(i,{joins:o,leaves:a},n,r)}},{key:"syncDiff",value:function(e,t,n,r){var i=this,s={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)},o=s.joins,a=s.leaves;return n||(n=function(){}),r||(r=function(){}),this.map(o,(function(t,r){var s=e[t];if(e[t]=i.cloneDeep(r),s){var o,a=e[t].map((function(e){return e.presence_id})),c=s.filter((function(e){return a.indexOf(e.presence_id)<0}));(o=e[t]).unshift.apply(o,(0,K.Z)(c))}n(t,s,r)})),this.map(a,(function(t,n){var i=e[t];if(i){var s=n.map((function(e){return e.presence_id}));i=i.filter((function(e){return s.indexOf(e.presence_id)<0})),e[t]=i,r(t,i,n),0===i.length&&delete e[t]}})),e}},{key:"list",value:function(e,t){return t||(t=function(e,t){return t}),this.map(e,(function(e,n){return t(e,n)}))}},{key:"map",value:function(e,t){return Object.getOwnPropertyNames(e).map((function(n){return t(n,e[n])}))}},{key:"transformState",value:function(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((function(t,n){var r=e[n];return t[n]="metas"in r?r.metas.map((function(e){return e.presence_id=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e})):r,t}),{})}},{key:"cloneDeep",value:function(e){return JSON.parse(JSON.stringify(e))}}]),e}(),Pe=function(){function e(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;r(this,e),this.topic=t,this.params=i,this.socket=s,this.bindings=[],this.state=ce.closed,this.joinedOnce=!1,this.pushBuffer=[],this.timeout=this.socket.timeout,this.joinPush=new Oe(this,ue.join,this.params,this.timeout),this.rejoinTimer=new Te((function(){return n.rejoinUntilConnected()}),this.socket.reconnectAfterMs),this.joinPush.receive("ok",(function(){n.state=ce.joined,n.rejoinTimer.reset(),n.pushBuffer.forEach((function(e){return e.send()})),n.pushBuffer=[]})),this.onClose((function(){n.rejoinTimer.reset(),n.socket.log("channel","close ".concat(n.topic," ").concat(n.joinRef())),n.state=ce.closed,n.socket.remove(n)})),this.onError((function(e){n.isLeaving()||n.isClosed()||(n.socket.log("channel","error ".concat(n.topic),e),n.state=ce.errored,n.rejoinTimer.scheduleTimeout())})),this.joinPush.receive("timeout",(function(){n.isJoining()&&(n.socket.log("channel","timeout ".concat(n.topic),n.joinPush.timeout),n.state=ce.errored,n.rejoinTimer.scheduleTimeout())})),this.on(ue.reply,{},(function(e,t){n.trigger(n.replyEventName(t),e)})),this.presence=new je(this)}return s(e,[{key:"list",value:function(){return this.presence.list()}},{key:"rejoinUntilConnected",value:function(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this.rejoin()}},{key:"subscribe",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;if(this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";var t=this.bindings.reduce((function(e,t){var n=t.type;return["phx_close","phx_error","phx_reply","presence_diff","presence_state"].includes(n)||(e[n]=t),e}),{});return Object.keys(t).length&&this.updateJoinPayload({configs:t}),this.joinedOnce=!0,this.rejoin(e),this.joinPush}},{key:"onClose",value:function(e){this.on(ue.close,{},e)}},{key:"onError",value:function(e){this.on(ue.error,{},(function(t){return e(t)}))}},{key:"on",value:function(e,t,n){this.bindings.push({type:e,filter:null!=t?t:{},callback:null!=n?n:function(){}})}},{key:"off",value:function(t,n){this.bindings=this.bindings.filter((function(r){return!(r.type===t&&e.isEqual(r.filter,n))}))}},{key:"canPush",value:function(){return this.socket.isConnected()&&this.isJoined()}},{key:"push",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.timeout;if(!this.joinedOnce)throw"tried to push '".concat(e,"' to '").concat(this.topic,"' before joining. Use channel.subscribe() before pushing events");var r=new Oe(this,e,t,n);return this.canPush()?r.send():(r.startTimeout(),this.pushBuffer.push(r)),r}},{key:"updateJoinPayload",value:function(e){this.joinPush.updatePayload(e)}},{key:"unsubscribe",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this.state=ce.leaving;var n=function(){e.socket.log("channel","leave ".concat(e.topic)),e.trigger(ue.close,"leave",e.joinRef())};this.joinPush.destroy();var r=new Oe(this,ue.leave,{},t);return r.receive("ok",(function(){return n()})).receive("timeout",(function(){return n()})),r.send(),this.canPush()||r.trigger("ok",{}),r}},{key:"onMessage",value:function(e,t,n){return t}},{key:"isMember",value:function(e){return this.topic===e}},{key:"joinRef",value:function(){return this.joinPush.ref}},{key:"rejoin",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this.isLeaving()||(this.socket.leaveOpenTopic(this.topic),this.state=ce.joining,this.joinPush.resend(e))}},{key:"trigger",value:function(e,t,n){var r=ue.close,i=ue.error,s=ue.leave,o=ue.join;if(!(n&&[r,i,s,o].indexOf(e)>=0&&n!==this.joinRef())){var a=this.onMessage(e,t,n);if(t&&!a)throw"channel onMessage callbacks must return the payload, modified or unmodified";this.bindings.filter((function(n){var r,i;return(null==n?void 0:n.type)===e&&("*"===(null===(r=null==n?void 0:n.filter)||void 0===r?void 0:r.event)||(null===(i=null==n?void 0:n.filter)||void 0===i?void 0:i.event)===(null==t?void 0:t.event))})).map((function(e){return e.callback(a,n)}))}}},{key:"send",value:function(e){var t=this.push(e.type,e);return new Promise((function(e){t.receive("ok",(function(){return e("ok")})),t.receive("timeout",(function(){return e("timeout")}))}))}},{key:"replyEventName",value:function(e){return"chan_reply_".concat(e)}},{key:"isClosed",value:function(){return this.state===ce.closed}},{key:"isErrored",value:function(){return this.state===ce.errored}},{key:"isJoined",value:function(){return this.state===ce.joined}},{key:"isJoining",value:function(){return this.state===ce.joining}},{key:"isLeaving",value:function(){return this.state===ce.leaving}}],[{key:"isEqual",value:function(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var n in e)if(e[n]!==t[n])return!1;return!0}}]),e}(),Re=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(t){s(t)}}function a(e){try{c(r.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))},Ce=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Ie=function(){},Ae=function(){function e(t,n){var i=this;r(this,e),this.accessToken=null,this.channels=[],this.endPoint="",this.headers=xe,this.params={},this.timeout=_e,this.transport=we.w3cwebsocket,this.heartbeatIntervalMs=3e4,this.longpollerTimeout=2e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Ie,this.conn=null,this.sendBuffer=[],this.serializer=new Se,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.endPoint="".concat(t,"/").concat(he.websocket),(null==n?void 0:n.params)&&(this.params=n.params),(null==n?void 0:n.headers)&&(this.headers=Object.assign(Object.assign({},this.headers),n.headers)),(null==n?void 0:n.timeout)&&(this.timeout=n.timeout),(null==n?void 0:n.logger)&&(this.logger=n.logger),(null==n?void 0:n.transport)&&(this.transport=n.transport),(null==n?void 0:n.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=n.heartbeatIntervalMs),(null==n?void 0:n.longpollerTimeout)&&(this.longpollerTimeout=n.longpollerTimeout),this.reconnectAfterMs=(null==n?void 0:n.reconnectAfterMs)?n.reconnectAfterMs:function(e){return[1e3,2e3,5e3,1e4][e-1]||1e4},this.encode=(null==n?void 0:n.encode)?n.encode:function(e,t){return t(JSON.stringify(e))},this.decode=(null==n?void 0:n.decode)?n.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Te((function(){return Re(i,void 0,void 0,a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.disconnect();case 2:this.connect();case 3:case"end":return e.stop()}}),e,this)})))}),this.reconnectAfterMs)}return s(e,[{key:"connect",value:function(){var e=this;this.conn||(this.conn=new this.transport(this.endPointURL(),[],null,this.headers),this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=function(){return e._onConnOpen()},this.conn.onerror=function(t){return e._onConnError(t)},this.conn.onmessage=function(t){return e.onConnMessage(t)},this.conn.onclose=function(t){return e._onConnClose(t)}))}},{key:"disconnect",value:function(e,t){var n=this;return new Promise((function(r,i){try{n.conn&&(n.conn.onclose=function(){},e?n.conn.close(e,t||""):n.conn.close(),n.conn=null,n.heartbeatTimer&&clearInterval(n.heartbeatTimer),n.reconnectTimer.reset()),r({error:null,data:!0})}catch(s){r({error:s,data:!1})}}))}},{key:"log",value:function(e,t,n){this.logger(e,t,n)}},{key:"onOpen",value:function(e){this.stateChangeCallbacks.open.push(e)}},{key:"onClose",value:function(e){this.stateChangeCallbacks.close.push(e)}},{key:"onError",value:function(e){this.stateChangeCallbacks.error.push(e)}},{key:"onMessage",value:function(e){this.stateChangeCallbacks.message.push(e)}},{key:"connectionState",value:function(){switch(this.conn&&this.conn.readyState){case ae.connecting:return le.Connecting;case ae.open:return le.Open;case ae.closing:return le.Closing;default:return le.Closed}}},{key:"isConnected",value:function(){return this.connectionState()===le.Open}},{key:"remove",value:function(e){this.channels=this.channels.filter((function(t){return t.joinRef()!==e.joinRef()}))}},{key:"channel",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.selfBroadcast,i=Ce(n,["selfBroadcast"]);r&&(i.self_broadcast=r);var s=(null===(t=this.params)||void 0===t?void 0:t.vsndate)?new Pe(e,i,this):new Ee(e,i,this);return s instanceof Pe&&(s.presence.onJoin((function(e,t,n){s.trigger("presence",{event:"JOIN",key:e,currentPresences:t,newPresences:n})})),s.presence.onLeave((function(e,t,n){s.trigger("presence",{event:"LEAVE",key:e,currentPresences:t,leftPresences:n})})),s.presence.onSync((function(){s.trigger("presence",{event:"SYNC"})}))),this.channels.push(s),s}},{key:"push",value:function(e){var t=this,n=e.topic,r=e.event,i=e.payload,s=e.ref,o=function(){t.encode(e,(function(e){var n;null===(n=t.conn)||void 0===n||n.send(e)}))};this.log("push","".concat(n," ").concat(r," (").concat(s,")"),i),this.isConnected()?o():this.sendBuffer.push(o)}},{key:"onConnMessage",value:function(e){var t=this;this.decode(e.data,(function(e){var n=e.topic,r=e.event,i=e.payload,s=e.ref;(s&&s===t.pendingHeartbeatRef||r===(null==i?void 0:i.type))&&(t.pendingHeartbeatRef=null),t.log("receive","".concat(i.status||""," ").concat(n," ").concat(r," ").concat(s&&"("+s+")"||""),i),t.channels.filter((function(e){return e.isMember(n)})).forEach((function(e){return e.trigger(r,i,s)})),t.stateChangeCallbacks.message.forEach((function(t){return t(e)}))}))}},{key:"endPointURL",value:function(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}},{key:"makeRef",value:function(){var e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}},{key:"setAuth",value:function(e){this.accessToken=e,this.channels.forEach((function(t){e&&t.updateJoinPayload({user_token:e}),t.joinedOnce&&t.isJoined()&&t.push(ue.access_token,{access_token:e})}))}},{key:"leaveOpenTopic",value:function(e){var t=this.channels.find((function(t){return t.topic===e&&(t.isJoined()||t.isJoining())}));t&&(this.log("transport",'leaving duplicate topic "'.concat(e,'"')),t.unsubscribe())}},{key:"_onConnOpen",value:function(){var e=this;this.log("transport","connected to ".concat(this.endPointURL())),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval((function(){return e._sendHeartbeat()}),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach((function(e){return e()}))}},{key:"_onConnClose",value:function(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach((function(t){return t(e)}))}},{key:"_onConnError",value:function(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach((function(t){return t(e)}))}},{key:"_triggerChanError",value:function(){this.channels.forEach((function(e){return e.trigger(ue.error)}))}},{key:"_appendParams",value:function(e,t){if(0===Object.keys(t).length)return e;var n=e.match(/\?/)?"&":"?",r=new URLSearchParams(t);return"".concat(e).concat(n).concat(r)}},{key:"_flushSendBuffer",value:function(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach((function(e){return e()})),this.sendBuffer=[])}},{key:"_sendHeartbeat",value:function(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),void(null===(e=this.conn)||void 0===e||e.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this.makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}}]),e}(),Ue=function(){function e(t,n,i,s){r(this,e);var o={},a="*"===s?"realtime:".concat(i):"realtime:".concat(i,":").concat(s),c=n.Authorization.split(" ")[1];c&&(o.user_token=c),this.subscription=t.channel(a,o)}return s(e,[{key:"getPayloadRecords",value:function(e){var t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=fe(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=fe(e.columns,e.old_record)),t}},{key:"on",value:function(e,t){var n=this;return this.subscription.on(e,(function(e){var r={schema:e.schema,table:e.table,commit_timestamp:e.commit_timestamp,eventType:e.type,new:{},old:{},errors:e.errors};r=Object.assign(Object.assign({},r),n.getPayloadRecords(e)),t(r)})),this}},{key:"subscribe",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};return this.subscription.onError((function(t){return e("SUBSCRIPTION_ERROR",t)})),this.subscription.onClose((function(){return e("CLOSED")})),this.subscription.subscribe().receive("ok",(function(){return e("SUBSCRIBED")})).receive("error",(function(t){return e("SUBSCRIPTION_ERROR",t)})).receive("timeout",(function(){return e("RETRYING_AFTER_TIMEOUT")})),this.subscription}}]),e}();function Ne(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f(this,n)}}var De=function(e){h(n,e);var t=Ne(n);function n(e,i){var s,o=i.headers,a=void 0===o?{}:o,c=i.schema,u=i.realtime,h=i.table,l=i.fetch,f=i.shouldThrowOnError;return r(this,n),(s=t.call(this,e,{headers:a,schema:c,fetch:l,shouldThrowOnError:f}))._subscription=null,s._realtime=u,s._headers=a,s._schema=c,s._table=h,s}return s(n,[{key:"on",value:function(e,t){return this._realtime.isConnected()||this._realtime.connect(),this._subscription||(this._subscription=new Ue(this._realtime,this._headers,this._schema,this._table)),this._subscription.on(e,t)}}]),n}(ee),Be=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(t){s(t)}}function a(e){try{c(r.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))},Le=function(e){return e.msg||e.message||e.error_description||e.error||JSON.stringify(e)},Je=function(e,t){if("function"!=typeof e.json)return t(e);e.json().then((function(n){return t({message:Le(n),status:(null==e?void 0:e.status)||500})}))},Me=function(e,t,n,r){var i={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?i:(i.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),i.body=JSON.stringify(r),Object.assign(Object.assign({},i),n))};function Ge(e,t,n,r,i,s){return Be(this,void 0,void 0,a().mark((function o(){return a().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",new Promise((function(o,a){e(n,Me(t,r,i,s)).then((function(e){if(!e.ok)throw e;return(null==r?void 0:r.noResolveJson)?o(e):e.json()})).then((function(e){return o(e)})).catch((function(e){return Je(e,a)}))})));case 1:case"end":return o.stop()}}),o)})))}function He(e,t,n,r){return Be(this,void 0,void 0,a().mark((function i(){return a().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",Ge(e,"GET",t,n,r));case 1:case"end":return i.stop()}}),i)})))}function Fe(e,t,n,r,i){return Be(this,void 0,void 0,a().mark((function s(){return a().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",Ge(e,"POST",t,r,i,n));case 1:case"end":return s.stop()}}),s)})))}function ze(e,t,n,r,i){return Be(this,void 0,void 0,a().mark((function s(){return a().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",Ge(e,"PUT",t,r,i,n));case 1:case"end":return s.stop()}}),s)})))}function qe(e,t,n,r,i){return Be(this,void 0,void 0,a().mark((function s(){return a().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",Ge(e,"DELETE",t,r,i,n));case 1:case"end":return s.stop()}}),s)})))}var Ke=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(t){s(t)}}function a(e){try{c(r.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))},We=function(e){var t;return t=e||("undefined"==typeof fetch?function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Ke(void 0,void 0,void 0,a().mark((function e(){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.e(944).then(n.t.bind(n,4944,23));case 2:return e.next=4,(r=e.sent).fetch.apply(r,t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})))}:fetch),function(){return t.apply(void 0,arguments)}},Xe=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(t){s(t)}}function a(e){try{c(r.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))},Ye={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ve={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1},Ze=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;r(this,e),this.url=t,this.headers=n,this.bucketId=i,this.fetch=We(s)}return s(e,[{key:"uploadOrUpdate",value:function(e,t,n,r){return Xe(this,void 0,void 0,a().mark((function i(){var s,o,c,u,h,l,f;return a().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,o=Object.assign(Object.assign({},Ve),r),c=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(o.upsert)}),"undefined"!=typeof Blob&&n instanceof Blob?((s=new FormData).append("cacheControl",o.cacheControl),s.append("",n)):"undefined"!=typeof FormData&&n instanceof FormData?(s=n).append("cacheControl",o.cacheControl):(s=n,c["cache-control"]="max-age=".concat(o.cacheControl),c["content-type"]=o.contentType),u=this._removeEmptyFolders(t),h=this._getFinalPath(u),i.next=8,this.fetch("".concat(this.url,"/object/").concat(h),{method:e,body:s,headers:c});case 8:if(!(l=i.sent).ok){i.next=13;break}return i.abrupt("return",{data:{Key:h},error:null});case 13:return i.next=15,l.json();case 15:return f=i.sent,i.abrupt("return",{data:null,error:f});case 17:i.next=22;break;case 19:return i.prev=19,i.t0=i.catch(0),i.abrupt("return",{data:null,error:i.t0});case 22:case"end":return i.stop()}}),i,this,[[0,19]])})))}},{key:"upload",value:function(e,t,n){return Xe(this,void 0,void 0,a().mark((function r(){return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.uploadOrUpdate("POST",e,t,n));case 1:case"end":return r.stop()}}),r,this)})))}},{key:"update",value:function(e,t,n){return Xe(this,void 0,void 0,a().mark((function r(){return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.uploadOrUpdate("PUT",e,t,n));case 1:case"end":return r.stop()}}),r,this)})))}},{key:"move",value:function(e,t){return Xe(this,void 0,void 0,a().mark((function n(){var r;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Fe(this.fetch,"".concat(this.url,"/object/move"),{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers});case 3:return r=n.sent,n.abrupt("return",{data:r,error:null});case 7:return n.prev=7,n.t0=n.catch(0),n.abrupt("return",{data:null,error:n.t0});case 10:case"end":return n.stop()}}),n,this,[[0,7]])})))}},{key:"copy",value:function(e,t){return Xe(this,void 0,void 0,a().mark((function n(){var r;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Fe(this.fetch,"".concat(this.url,"/object/copy"),{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers});case 3:return r=n.sent,n.abrupt("return",{data:r,error:null});case 7:return n.prev=7,n.t0=n.catch(0),n.abrupt("return",{data:null,error:n.t0});case 10:case"end":return n.stop()}}),n,this,[[0,7]])})))}},{key:"createSignedUrl",value:function(e,t){return Xe(this,void 0,void 0,a().mark((function n(){var r,i,s;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,r=this._getFinalPath(e),n.next=4,Fe(this.fetch,"".concat(this.url,"/object/sign/").concat(r),{expiresIn:t},{headers:this.headers});case 4:return i=n.sent,s="".concat(this.url).concat(i.signedURL),i={signedURL:s},n.abrupt("return",{data:i,error:null,signedURL:s});case 10:return n.prev=10,n.t0=n.catch(0),n.abrupt("return",{data:null,error:n.t0,signedURL:null});case 13:case"end":return n.stop()}}),n,this,[[0,10]])})))}},{key:"createSignedUrls",value:function(e,t){return Xe(this,void 0,void 0,a().mark((function n(){var r,i=this;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Fe(this.fetch,"".concat(this.url,"/object/sign/").concat(this.bucketId),{expiresIn:t,paths:e},{headers:this.headers});case 3:return r=n.sent,n.abrupt("return",{data:r.map((function(e){return Object.assign(Object.assign({},e),{signedURL:e.signedURL?"".concat(i.url).concat(e.signedURL):null})})),error:null});case 7:return n.prev=7,n.t0=n.catch(0),n.abrupt("return",{data:null,error:n.t0});case 10:case"end":return n.stop()}}),n,this,[[0,7]])})))}},{key:"download",value:function(e){return Xe(this,void 0,void 0,a().mark((function t(){var n,r,i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=this._getFinalPath(e),t.next=4,He(this.fetch,"".concat(this.url,"/object/").concat(n),{headers:this.headers,noResolveJson:!0});case 4:return r=t.sent,t.next=7,r.blob();case 7:return i=t.sent,t.abrupt("return",{data:i,error:null});case 11:return t.prev=11,t.t0=t.catch(0),t.abrupt("return",{data:null,error:t.t0});case 14:case"end":return t.stop()}}),t,this,[[0,11]])})))}},{key:"getPublicUrl",value:function(e){try{var t=this._getFinalPath(e),n="".concat(this.url,"/object/public/").concat(t);return{data:{publicURL:n},error:null,publicURL:n}}catch(r){return{data:null,error:r,publicURL:null}}}},{key:"remove",value:function(e){return Xe(this,void 0,void 0,a().mark((function t(){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,qe(this.fetch,"".concat(this.url,"/object/").concat(this.bucketId),{prefixes:e},{headers:this.headers});case 3:return n=t.sent,t.abrupt("return",{data:n,error:null});case 7:return t.prev=7,t.t0=t.catch(0),t.abrupt("return",{data:null,error:t.t0});case 10:case"end":return t.stop()}}),t,this,[[0,7]])})))}},{key:"list",value:function(e,t,n){return Xe(this,void 0,void 0,a().mark((function r(){var i,s;return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,i=Object.assign(Object.assign(Object.assign({},Ye),t),{prefix:e||""}),r.next=4,Fe(this.fetch,"".concat(this.url,"/object/list/").concat(this.bucketId),i,{headers:this.headers},n);case 4:return s=r.sent,r.abrupt("return",{data:s,error:null});case 8:return r.prev=8,r.t0=r.catch(0),r.abrupt("return",{data:null,error:r.t0});case 11:case"end":return r.stop()}}),r,this,[[0,8]])})))}},{key:"_getFinalPath",value:function(e){return"".concat(this.bucketId,"/").concat(e)}},{key:"_removeEmptyFolders",value:function(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}}]),e}(),$e={"X-Client-Info":"storage-js/".concat("0.0.0")},Qe=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(t){s(t)}}function a(e){try{c(r.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))},et=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;r(this,e),this.url=t,this.headers=Object.assign(Object.assign({},$e),n),this.fetch=We(i)}return s(e,[{key:"listBuckets",value:function(){return Qe(this,void 0,void 0,a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,He(this.fetch,"".concat(this.url,"/bucket"),{headers:this.headers});case 3:return t=e.sent,e.abrupt("return",{data:t,error:null});case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",{data:null,error:e.t0});case 10:case"end":return e.stop()}}),e,this,[[0,7]])})))}},{key:"getBucket",value:function(e){return Qe(this,void 0,void 0,a().mark((function t(){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,He(this.fetch,"".concat(this.url,"/bucket/").concat(e),{headers:this.headers});case 3:return n=t.sent,t.abrupt("return",{data:n,error:null});case 7:return t.prev=7,t.t0=t.catch(0),t.abrupt("return",{data:null,error:t.t0});case 10:case"end":return t.stop()}}),t,this,[[0,7]])})))}},{key:"createBucket",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{public:!1};return Qe(this,void 0,void 0,a().mark((function n(){var r;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Fe(this.fetch,"".concat(this.url,"/bucket"),{id:e,name:e,public:t.public},{headers:this.headers});case 3:return r=n.sent,n.abrupt("return",{data:r.name,error:null});case 7:return n.prev=7,n.t0=n.catch(0),n.abrupt("return",{data:null,error:n.t0});case 10:case"end":return n.stop()}}),n,this,[[0,7]])})))}},{key:"updateBucket",value:function(e,t){return Qe(this,void 0,void 0,a().mark((function n(){var r;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,ze(this.fetch,"".concat(this.url,"/bucket/").concat(e),{id:e,name:e,public:t.public},{headers:this.headers});case 3:return r=n.sent,n.abrupt("return",{data:r,error:null});case 7:return n.prev=7,n.t0=n.catch(0),n.abrupt("return",{data:null,error:n.t0});case 10:case"end":return n.stop()}}),n,this,[[0,7]])})))}},{key:"emptyBucket",value:function(e){return Qe(this,void 0,void 0,a().mark((function t(){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Fe(this.fetch,"".concat(this.url,"/bucket/").concat(e,"/empty"),{},{headers:this.headers});case 3:return n=t.sent,t.abrupt("return",{data:n,error:null});case 7:return t.prev=7,t.t0=t.catch(0),t.abrupt("return",{data:null,error:t.t0});case 10:case"end":return t.stop()}}),t,this,[[0,7]])})))}},{key:"deleteBucket",value:function(e){return Qe(this,void 0,void 0,a().mark((function t(){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,qe(this.fetch,"".concat(this.url,"/bucket/").concat(e),{},{headers:this.headers});case 3:return n=t.sent,t.abrupt("return",{data:n,error:null});case 7:return t.prev=7,t.t0=t.catch(0),t.abrupt("return",{data:null,error:t.t0});case 10:case"end":return t.stop()}}),t,this,[[0,7]])})))}}]),e}();function tt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var i=d(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f(this,n)}}var nt=function(e){h(n,e);var t=tt(n);function n(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;return r(this,n),t.call(this,e,i,s)}return s(n,[{key:"from",value:function(e){return new Ze(this.url,this.headers,e,this.fetch)}}]),n}(et),rt=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(t){s(t)}}function a(e){try{c(r.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))},it=function(e){var t;return t=e||("undefined"==typeof fetch?function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return rt(void 0,void 0,void 0,a().mark((function e(){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.e(944).then(n.t.bind(n,4944,23));case 2:return e.next=4,(r=e.sent).fetch.apply(r,t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})))}:fetch),function(){return t.apply(void 0,arguments)}},st=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(t){s(t)}}function a(e){try{c(r.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))},ot=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.headers,s=void 0===i?{}:i,o=n.customFetch;r(this,e),this.url=t,this.headers=s,this.fetch=it(o)}return s(e,[{key:"setAuth",value:function(e){this.headers.Authorization="Bearer ".concat(e)}},{key:"invoke",value:function(e,t){return st(this,void 0,void 0,a().mark((function n(){var r,i,s,o,c,u,h;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,i=(r=null!=t?t:{}).headers,s=r.body,n.next=4,this.fetch("".concat(this.url,"/").concat(e),{method:"POST",headers:Object.assign({},this.headers,i),body:s});case 4:if(o=n.sent,!(c=o.headers.get("x-relay-error"))||"true"!==c){n.next=13;break}return n.t0=Error,n.next=10,o.text();case 10:return n.t1=n.sent,n.t2=new n.t0(n.t1),n.abrupt("return",{data:null,error:n.t2});case 13:if((h=(null!=t?t:{}).responseType)&&"json"!==h){n.next=20;break}return n.next=17,o.json();case 17:u=n.sent,n.next=35;break;case 20:if("arrayBuffer"!==h){n.next=26;break}return n.next=23,o.arrayBuffer();case 23:u=n.sent,n.next=35;break;case 26:if("blob"!==h){n.next=32;break}return n.next=29,o.blob();case 29:u=n.sent,n.next=35;break;case 32:return n.next=34,o.text();case 34:u=n.sent;case 35:return n.abrupt("return",{data:u,error:null});case 38:return n.prev=38,n.t3=n.catch(0),n.abrupt("return",{data:null,error:n.t3});case 41:case"end":return n.stop()}}),n,this,[[0,38]])})))}}]),e}(),at=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(t){s(t)}}function a(e){try{c(r.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))},ct={schema:"public",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,multiTab:!0,headers:c},ut=function(){function e(t,n,i){if(r(this,e),this.supabaseUrl=t,this.supabaseKey=n,!t)throw new Error("supabaseUrl is required.");if(!n)throw new Error("supabaseKey is required.");var s=t.replace(/\/$/,""),o=Object.assign(Object.assign({},ct),i);if(this.restUrl="".concat(s,"/rest/v1"),this.realtimeUrl="".concat(s,"/realtime/v1").replace("http","ws"),this.authUrl="".concat(s,"/auth/v1"),this.storageUrl="".concat(s,"/storage/v1"),s.match(/(supabase\.co)|(supabase\.in)/)){var a=s.split(".");this.functionsUrl="".concat(a[0],".functions.").concat(a[1],".").concat(a[2])}else this.functionsUrl="".concat(s,"/functions/v1");this.schema=o.schema,this.multiTab=o.multiTab,this.fetch=o.fetch,this.headers=Object.assign(Object.assign({},c),null==i?void 0:i.headers),this.shouldThrowOnError=o.shouldThrowOnError||!1,this.auth=this._initSupabaseAuthClient(o),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},o.realtime)),this._listenForAuthEvents(),this._listenForMultiTabEvents()}return s(e,[{key:"functions",get:function(){return new ot(this.functionsUrl,{headers:this._getAuthHeaders(),customFetch:this.fetch})}},{key:"storage",get:function(){return new nt(this.storageUrl,this._getAuthHeaders(),this.fetch)}},{key:"from",value:function(e){var t="".concat(this.restUrl,"/").concat(e);return new De(t,{headers:this._getAuthHeaders(),schema:this.schema,realtime:this.realtime,table:e,fetch:this.fetch,shouldThrowOnError:this.shouldThrowOnError})}},{key:"rpc",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.head,i=void 0!==r&&r,s=n.count,o=void 0===s?null:s,a=this._initPostgRESTClient();return a.rpc(e,t,{head:i,count:o})}},{key:"channel",value:function(e,t){var n,r,i=null!==(r=null===(n=this.auth.session())||void 0===n?void 0:n.access_token)&&void 0!==r?r:this.supabaseKey;return this.realtime.isConnected()||this.realtime.connect(),this.realtime.channel(e,Object.assign(Object.assign({},t),{user_token:i}))}},{key:"removeAllSubscriptions",value:function(){return at(this,void 0,void 0,a().mark((function e(){var t,n,r,i=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getSubscriptions().slice(),n=t.map((function(e){return i.removeSubscription(e)})),e.next=4,Promise.all(n);case 4:return r=e.sent,e.abrupt("return",r.map((function(e,n){var r=e.error;return{data:{subscription:t[n]},error:r}})));case 6:case"end":return e.stop()}}),e,this)})))}},{key:"removeChannel",value:function(e){return at(this,void 0,void 0,a().mark((function t(){var n,r,i,s;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._closeSubscription(e);case 2:if(n=t.sent,r=n.error,i=this.getSubscriptions(),s=i.filter((function(e){return e.isJoined()})).length,0!==i.length){t.next=9;break}return t.next=9,this.realtime.disconnect();case 9:return t.abrupt("return",{data:{openChannels:s},error:r});case 10:case"end":return t.stop()}}),t,this)})))}},{key:"removeSubscription",value:function(e){return at(this,void 0,void 0,a().mark((function t(){var n,r,i,s;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._closeSubscription(e);case 2:if(n=t.sent,r=n.error,i=this.getSubscriptions(),s=i.filter((function(e){return e.isJoined()})).length,0!==i.length){t.next=9;break}return t.next=9,this.realtime.disconnect();case 9:return t.abrupt("return",{data:{openSubscriptions:s},error:r});case 10:case"end":return t.stop()}}),t,this)})))}},{key:"_closeSubscription",value:function(e){return at(this,void 0,void 0,a().mark((function t(){var n,r,i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=null,e.isClosed()){t.next=7;break}return t.next=4,this._unsubscribeSubscription(e);case 4:r=t.sent,i=r.error,n=i;case 7:return this.realtime.remove(e),t.abrupt("return",{error:n});case 9:case"end":return t.stop()}}),t,this)})))}},{key:"_unsubscribeSubscription",value:function(e){return new Promise((function(t){e.unsubscribe().receive("ok",(function(){return t({error:null})})).receive("error",(function(e){return t({error:e})})).receive("timeout",(function(){return t({error:new Error("timed out")})}))}))}},{key:"getSubscriptions",value:function(){return this.realtime.channels}},{key:"_initSupabaseAuthClient",value:function(e){var t=e.autoRefreshToken,n=e.persistSession,r=e.detectSessionInUrl,i=e.localStorage,s=e.headers,o=e.fetch,a=e.cookieOptions,c=e.multiTab,u={Authorization:"Bearer ".concat(this.supabaseKey),apikey:"".concat(this.supabaseKey)};return new q({url:this.authUrl,headers:Object.assign(Object.assign({},s),u),autoRefreshToken:t,persistSession:n,detectSessionInUrl:r,localStorage:i,fetch:o,cookieOptions:a,multiTab:c})}},{key:"_initRealtimeClient",value:function(e){return new Ae(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign(Object.assign({},null==e?void 0:e.params),{apikey:this.supabaseKey})}))}},{key:"_initPostgRESTClient",value:function(){return new oe(this.restUrl,{headers:this._getAuthHeaders(),schema:this.schema,fetch:this.fetch,throwOnError:this.shouldThrowOnError})}},{key:"_getAuthHeaders",value:function(){var e,t,n=Object.assign({},this.headers),r=null!==(t=null===(e=this.auth.session())||void 0===e?void 0:e.access_token)&&void 0!==t?t:this.supabaseKey;return n.apikey=this.supabaseKey,n.Authorization=n.Authorization||"Bearer ".concat(r),n}},{key:"_listenForMultiTabEvents",value:function(){var e=this;if(!this.multiTab||"undefined"==typeof window||!(null===window||void 0===window?void 0:window.addEventListener))return null;try{return null===window||void 0===window?void 0:window.addEventListener("storage",(function(t){var n,r,i;if("supabase.auth.token"===t.key){var s=JSON.parse(String(t.newValue)),o=null!==(r=null===(n=null==s?void 0:s.currentSession)||void 0===n?void 0:n.access_token)&&void 0!==r?r:void 0,a=null===(i=e.auth.session())||void 0===i?void 0:i.access_token;o?!a&&o?e._handleTokenChanged("SIGNED_IN",o,"STORAGE"):a!==o&&e._handleTokenChanged("TOKEN_REFRESHED",o,"STORAGE"):e._handleTokenChanged("SIGNED_OUT",o,"STORAGE")}}))}catch(t){return console.error("_listenForMultiTabEvents",t),null}}},{key:"_listenForAuthEvents",value:function(){var e=this;return this.auth.onAuthStateChange((function(t,n){e._handleTokenChanged(t,null==n?void 0:n.access_token,"CLIENT")})).data}},{key:"_handleTokenChanged",value:function(e,t,n){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===t?"SIGNED_OUT"!==e&&"USER_DELETED"!==e||(this.realtime.setAuth(this.supabaseKey),"STORAGE"==n&&this.auth.signOut()):(this.realtime.setAuth(t),"STORAGE"==n&&this.auth.setAuth(t),this.changedAccessToken=t)}}]),e}(),ht=function(e,t,n){return new ut(e,t,n)}("https://tqodfyadkocrkvniakxp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRxb2RmeWFka29jcmt2bmlha3hwIiwicm9sZSI6ImFub24iLCJpYXQiOjE2NTU4MzMwNTUsImV4cCI6MTk3MTQwOTA1NX0.k67wgyYXyu28YUu-cSErTJApvYnXocrdkbhu7lv-1kE")},9794:function(e){"use strict";e.exports={version:"1.0.34"}}}]);
//# sourceMappingURL=abe19695ffda30b4412ddad54b30e175ff06a263-b0cc6886d3e1724ef6a7.js.map